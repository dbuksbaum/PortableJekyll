<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Logging::Appenders::RollingFile - logging-2.0.0 Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/logging/appenders/rolling_file.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="IO.html">Logging::Appenders::IO</a>
  
</nav>

    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-age_fn_mtime">#age_fn_mtime</a>
    
    <li ><a href="#method-i-build_singleton_methods">#build_singleton_methods</a>
    
    <li ><a href="#method-i-canonical_write">#canonical_write</a>
    
    <li ><a href="#method-i-copy_file">#copy_file</a>
    
    <li ><a href="#method-i-copy_truncate">#copy_truncate</a>
    
    <li ><a href="#method-i-filename">#filename</a>
    
    <li class="calls-super" ><a href="#method-i-reopen">#reopen</a>
    
    <li ><a href="#method-i-roll_required-3F">#roll_required?</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../History_txt.html">History</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../File.html">File</a>
  
    <li><a href="../../FileUtils.html">FileUtils</a>
  
    <li><a href="../../Logging.html">Logging</a>
  
    <li><a href="../../Logging/Appender.html">Logging::Appender</a>
  
    <li><a href="../../Logging/Appenders.html">Logging::Appenders</a>
  
    <li><a href="../../Logging/Appenders/Buffering.html">Logging::Appenders::Buffering</a>
  
    <li><a href="../../Logging/Appenders/File.html">Logging::Appenders::File</a>
  
    <li><a href="../../Logging/Appenders/IO.html">Logging::Appenders::IO</a>
  
    <li><a href="../../Logging/Appenders/RollingFile.html">Logging::Appenders::RollingFile</a>
  
    <li><a href="../../Logging/Appenders/RollingFile/Roller.html">Logging::Appenders::RollingFile::Roller</a>
  
    <li><a href="../../Logging/Appenders/Stderr.html">Logging::Appenders::Stderr</a>
  
    <li><a href="../../Logging/Appenders/Stdout.html">Logging::Appenders::Stdout</a>
  
    <li><a href="../../Logging/Appenders/StringIo.html">Logging::Appenders::StringIo</a>
  
    <li><a href="../../Logging/Appenders/Syslog.html">Logging::Appenders::Syslog</a>
  
    <li><a href="../../Logging/ColorScheme.html">Logging::ColorScheme</a>
  
    <li><a href="../../Logging/Filter.html">Logging::Filter</a>
  
    <li><a href="../../Logging/Filters.html">Logging::Filters</a>
  
    <li><a href="../../Logging/Filters/Level.html">Logging::Filters::Level</a>
  
    <li><a href="../../Logging/Layout.html">Logging::Layout</a>
  
    <li><a href="../../Logging/Layouts.html">Logging::Layouts</a>
  
    <li><a href="../../Logging/Layouts/Basic.html">Logging::Layouts::Basic</a>
  
    <li><a href="../../Logging/Layouts/Parseable.html">Logging::Layouts::Parseable</a>
  
    <li><a href="../../Logging/Layouts/Parseable/layout;.html">Logging::Layouts::Parseable::layout;</a>
  
    <li><a href="../../Logging/Layouts/Pattern.html">Logging::Layouts::Pattern</a>
  
    <li><a href="../../Logging/Logger.html">Logging::Logger</a>
  
    <li><a href="../../Logging/Logger.html">Logging::Logger</a>
  
    <li><a href="../../Logging/MappedDiagnosticContext.html">Logging::MappedDiagnosticContext</a>
  
    <li><a href="../../Logging/NestedDiagnosticContext.html">Logging::NestedDiagnosticContext</a>
  
    <li><a href="../../Logging/Proxy.html">Logging::Proxy</a>
  
    <li><a href="../../Logging/RailsCompat.html">Logging::RailsCompat</a>
  
    <li><a href="../../Logging/Repository.html">Logging::Repository</a>
  
    <li><a href="../../Logging/Repository/Singleton.html">Logging::Repository::Singleton</a>
  
    <li><a href="../../Logging/RootLogger.html">Logging::RootLogger</a>
  
    <li><a href="../../Logging/logger.html">Logging::logger</a>
  
    <li><a href="../../Module.html">Module</a>
  
    <li><a href="../../Object.html">Object</a>
  
    <li><a href="../../RSpec.html">RSpec</a>
  
    <li><a href="../../RSpec/Core.html">RSpec::Core</a>
  
    <li><a href="../../RSpec/Core/Configuration.html">RSpec::Core::Configuration</a>
  
    <li><a href="../../RSpec/LoggingHelper.html">RSpec::LoggingHelper</a>
  
    <li><a href="../../RSpec/LoggingHelper.html">RSpec::LoggingHelper</a>
  
    <li><a href="../../ReentrantMutex.html">ReentrantMutex</a>
  
    <li><a href="../../Spec.html">Spec</a>
  
    <li><a href="../../Spec/Runner.html">Spec::Runner</a>
  
    <li><a href="../../Spec/Runner/Configuration.html">Spec::Runner::Configuration</a>
  
    <li><a href="../../String.html">String</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Logging::Appenders::RollingFile</h1>

  <div id="description" class="description">
    
<p>An appender that writes to a file and ensures that the file size or age
never exceeds some user specified level.</p>

<p>The goal of this class is to write log messages to a file. When the file
age or size exceeds a given limit then the log file is copied and then
truncated. The name of the copy indicates it is an older log file.</p>

<p>The name of the log file is changed by inserting the age of the log file
(as a single number) between the log file name and the extension. If the
file has no extension then the number is appended to the filename. Here is
a simple example:</p>

<pre class="ruby"><span class="ruby-regexp">/var/</span><span class="ruby-identifier">log</span><span class="ruby-operator">/</span><span class="ruby-identifier">ruby</span>.<span class="ruby-identifier">log</span>   =<span class="ruby-operator">&gt;</span>   <span class="ruby-regexp">/var/</span><span class="ruby-identifier">log</span><span class="ruby-operator">/</span><span class="ruby-identifier">ruby</span><span class="ruby-value">.1</span>.<span class="ruby-identifier">log</span>
</pre>

<p>New log messages will continue to be appended to the same log file
(`/var/log/ruby.log` in our example above). The age number for all older
log files is incremented when the log file is rolled. The number of older
log files to keep can be given, otherwise all the log files are kept.</p>

<p>The actual process of rolling all the log file names can be expensive if
there are many, many older log files to process.</p>

<p>If you do not wish to use numbered files when rolling, you can specify the
:roll_by option as &#39;date&#39;. This will use a date/time stamp to
differentiate the older files from one another. If you configure your
rolling file appender to roll daily and ignore the file size:</p>

<pre class="ruby"><span class="ruby-regexp">/var/</span><span class="ruby-identifier">log</span><span class="ruby-operator">/</span><span class="ruby-identifier">ruby</span>.<span class="ruby-identifier">log</span>   =<span class="ruby-operator">&gt;</span>   <span class="ruby-regexp">/var/</span><span class="ruby-identifier">log</span><span class="ruby-operator">/</span><span class="ruby-identifier">ruby</span><span class="ruby-value">.20091225</span>.<span class="ruby-identifier">log</span>
</pre>

<p>Where the date is expressed as `%Y%m%d` in the Time#strftime format.</p>

<p>NOTE: this class is not safe to use when log messages are written to files
on NFS mounts or other remote file system. It should only be used for log
files on the local file system. The exception to this is when a single
process is writing to the log file; remote file systems are safe to use in
this case but still not recommended.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            new( name, opts )
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Creates a new Rolling <a href="File.html">File</a> <a
href="../Appender.html">Appender</a>. The <em>name</em> is the unique <a
href="../Appender.html">Appender</a> name used to retrieve this appender
from the <a href="../Appender.html">Appender</a> hash. The only required
option is the filename to use for creating log files.</p>

<pre>[:filename]  The base filename to use when constructing new log
             filenames.</pre>

<p>The “rolling” portion of the filename can be configured via some simple
pattern templates. For numbered rolling, you can use {{.%d}}</p>

<pre class="ruby"><span class="ruby-string">&quot;logname{{.%d}}.log&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;logname.log&quot;</span>, <span class="ruby-string">&quot;logname.1.log&quot;</span>, <span class="ruby-string">&quot;logname.2.log&quot;</span> <span class="ruby-operator">...</span>]
<span class="ruby-string">&quot;logname.log{{-%d}}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;logname.log&quot;</span>, <span class="ruby-string">&quot;logname.log-1&quot;</span>, <span class="ruby-string">&quot;logname.log-2&quot;</span> <span class="ruby-operator">...</span>]
</pre>

<p>And for date rolling you can use `strftime` patterns:</p>

<pre class="ruby"><span class="ruby-string">&quot;logname{{.%Y%m%d}}.log&quot;</span>            =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;logname.log, &quot;</span><span class="ruby-identifier">logname</span><span class="ruby-value">.20130626</span>.<span class="ruby-identifier">log</span><span class="ruby-string">&quot; ...]
&quot;</span><span class="ruby-identifier">logname</span>{{.<span class="ruby-operator">%</span><span class="ruby-constant">Y</span><span class="ruby-operator">-</span><span class="ruby-operator">%</span><span class="ruby-operator">-</span><span class="ruby-operator">%</span><span class="ruby-constant">T</span><span class="ruby-operator">%</span><span class="ruby-constant">H</span>:<span class="ruby-operator">%</span><span class="ruby-constant">M</span>:<span class="ruby-operator">%</span><span class="ruby-constant">S</span>}}.<span class="ruby-identifier">log</span><span class="ruby-string">&quot; =&gt; [&quot;</span><span class="ruby-identifier">logname</span>.<span class="ruby-identifier">log</span>, <span class="ruby-string">&quot;logname.2013-06-26T22:03:31.log&quot;</span> <span class="ruby-operator">...</span>]
</pre>

<p>If the defaults suit you fine, just pass in the :roll_by option and use
your normal log filename without any pattern template.</p>

<p>The following options are optional:</p>

<pre>[:layout]    The Layout that will be used by this appender. The Basic
             layout will be used if none is given.
[:truncate]  When set to true any existing log files will be rolled
             immediately and a new, empty log file will be created.
[:size]      The maximum allowed size (in bytes) of a log file before
             it is rolled.
[:age]       The maximum age (in seconds) of a log file before it is
             rolled. The age can also be given as &#39;daily&#39;, &#39;weekly&#39;,
             or &#39;monthly&#39;.
[:keep]      The number of rolled log files to keep.
[:roll_by]   How to name the rolled log files. This can be &#39;number&#39; or
             &#39;date&#39;.</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="IO.html#method-c-new">Logging::Appenders::IO.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span> = {} )
  <span class="ruby-ivar">@roller</span> = <span class="ruby-constant">Roller</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>

  <span class="ruby-comment"># grab our options</span>
  <span class="ruby-ivar">@size</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:size</span>, <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@size</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-ivar">@size</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@size</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-ivar">@age_fn</span> = <span class="ruby-identifier">filename</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.age&#39;</span>
  <span class="ruby-ivar">@age_fn_mtime</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@age</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:age</span>, <span class="ruby-keyword">nil</span>)

  <span class="ruby-comment"># create our `sufficiently_aged?` method</span>
  <span class="ruby-identifier">build_singleton_methods</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">touch</span>(<span class="ruby-ivar">@age_fn</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@age</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">test</span>(<span class="ruby-string">f</span>, <span class="ruby-ivar">@age_fn</span>)

  <span class="ruby-comment"># we are opening the file in read/write mode so that a shared lock can</span>
  <span class="ruby-comment"># be used on the file descriptor =&gt; http://pubs.opengroup.org/onlinepubs/009695399/functions/fcntl.html</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">encoding</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;a+:#{encoding}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;a+&#39;</span>
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-ivar">@mode</span>), <span class="ruby-identifier">opts</span>)

  <span class="ruby-comment"># if the truncate flag was set to true, then roll</span>
  <span class="ruby-identifier">roll_now</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:truncate</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">roll_now</span>
    <span class="ruby-identifier">copy_truncate</span>
    <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">roll_files</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-filename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filename</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the path to the logfile.</p>
          
          

          
          <div class="method-source-code" id="filename-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">filename</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- filename-source -->
          
        </div>

        

        
      </div><!-- filename-method -->

    
      <div id="method-i-reopen" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reopen</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reopen the connection to the underlying logging destination. If the
connection is currently closed then it will be opened. If the connection is
currently open then it will be closed and immediately opened.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Buffering.html#method-i-reopen">Logging::Appenders::Buffering#reopen</a>
            </div>
          

          
          <div class="method-source-code" id="reopen-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reopen</span>
  <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">synchronize</span> {
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@io</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@io</span>
      <span class="ruby-identifier">flush</span>
      <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@io</span> = <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-ivar">@mode</span>)
  }
  <span class="ruby-keyword">super</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reopen-source -->
          
        </div>

        

        
      </div><!-- reopen-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-age_fn_mtime" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">age_fn_mtime</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the modification time of the age file.</p>
          
          

          
          <div class="method-source-code" id="age_fn_mtime-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">age_fn_mtime</span>
  <span class="ruby-ivar">@age_fn_mtime</span> <span class="ruby-operator">||=</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-ivar">@age_fn</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- age_fn_mtime-source -->
          
        </div>

        

        
      </div><!-- age_fn_mtime-method -->

    
      <div id="method-i-build_singleton_methods" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_singleton_methods</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>We use meta-programming here to define the `sufficiently_aged?` method for
the rolling appender. The `sufficiently_aged?` method is responsible for
determining if the current log file is older than the rolling criteria -
daily, weekly, etc.</p>

<p>Returns this rolling file appender instance</p>
          
          

          
          <div class="method-source-code" id="build_singleton_methods-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_singleton_methods</span>
  <span class="ruby-identifier">method</span> =
    <span class="ruby-keyword">case</span> <span class="ruby-ivar">@age</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;daily&#39;</span>
      <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> {
        <span class="ruby-identifier">now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        (<span class="ruby-identifier">now</span>.<span class="ruby-identifier">day</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">age_fn_mtime</span>.<span class="ruby-identifier">day</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">age_fn_mtime</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">86400</span>
      }

    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;weekly&#39;</span>
      <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> { (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">age_fn_mtime</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">604800</span> }

    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;monthly&#39;</span>
      <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> {
        <span class="ruby-identifier">now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        (<span class="ruby-identifier">now</span>.<span class="ruby-identifier">month</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">age_fn_mtime</span>.<span class="ruby-identifier">month</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">age_fn_mtime</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">2678400</span>
      }

    <span class="ruby-keyword">when</span> <span class="ruby-constant">Integer</span>, <span class="ruby-constant">String</span>
      <span class="ruby-ivar">@age</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-ivar">@age</span>)
      <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> { (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">age_fn_mtime</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@age</span> }

    <span class="ruby-keyword">else</span>
      <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> { <span class="ruby-keyword">false</span> }
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">define_singleton_method</span>(<span class="ruby-value">:sufficiently_aged?</span>, <span class="ruby-identifier">method</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_singleton_methods-source -->
          
        </div>

        

        
      </div><!-- build_singleton_methods-method -->

    
      <div id="method-i-canonical_write" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">canonical_write</span><span
            class="method-args">( str )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Write the given <em>event</em> to the log file. The log file will be rolled
if the maximum file size is exceeded or if the file is older than the
maximum age.</p>
          
          

          
          <div class="method-source-code" id="canonical_write-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">canonical_write</span>( <span class="ruby-identifier">str</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">encoding</span>
  <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">flock_sh</span> { <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">syswrite</span> <span class="ruby-identifier">str</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">roll_required?</span>
    <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">flock?</span> {
      <span class="ruby-ivar">@age_fn_mtime</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">copy_truncate</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">roll_required?</span>
    }
    <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">roll_files</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">level</span> = <span class="ruby-value">:off</span>
  <span class="ruby-operator">::</span><span class="ruby-constant">Logging</span>.<span class="ruby-identifier">log_internal</span> {<span class="ruby-node">&quot;appender #{name.inspect} has been disabled&quot;</span>}
  <span class="ruby-operator">::</span><span class="ruby-constant">Logging</span>.<span class="ruby-identifier">log_internal_error</span>(<span class="ruby-identifier">err</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- canonical_write-source -->
          
        </div>

        

        
      </div><!-- canonical_write-method -->

    
      <div id="method-i-copy_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">copy_file</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the file name to use as the temporary copy location. We are using
copy-and-truncate semantics for rolling files so that the <a
href="IO.html">IO</a> file descriptor remains valid during rolling.</p>
          
          

          
          <div class="method-source-code" id="copy_file-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 140</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">copy_file</span>
  <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">copy_file</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- copy_file-source -->
          
        </div>

        

        
      </div><!-- copy_file-method -->

    
      <div id="method-i-copy_truncate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">copy_truncate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Copy the contents of the logfile to another file. Truncate the logfile to
zero length. This method will set the roll flag so that all the current
logfiles will be rolled along with the copied file.</p>
          
          

          
          <div class="method-source-code" id="copy_truncate-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">copy_truncate</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">copy_file</span>
  <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">truncate</span> <span class="ruby-value">0</span>

  <span class="ruby-comment"># touch the age file if needed</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@age</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">touch</span> <span class="ruby-ivar">@age_fn</span>
    <span class="ruby-ivar">@age_fn_mtime</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">roll</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- copy_truncate-source -->
          
        </div>

        

        
      </div><!-- copy_truncate-method -->

    
      <div id="method-i-roll_required-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">roll_required?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns <code>true</code> if the log file needs to be rolled.</p>
          
          

          
          <div class="method-source-code" id="roll_required-3F-source">
            <pre><span class="ruby-comment"># File lib/logging/appenders/rolling_file.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">roll_required?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">copy_file</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">copy_file</span>)) <span class="ruby-operator">&lt;</span> <span class="ruby-value">180</span>

  <span class="ruby-comment"># check if max size has been exceeded</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-ivar">@size</span> <span class="ruby-operator">?</span> <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@size</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>

  <span class="ruby-comment"># check if max age has been exceeded</span>
  <span class="ruby-identifier">a</span> = <span class="ruby-identifier">sufficiently_aged?</span>

  <span class="ruby-keyword">return</span> (<span class="ruby-identifier">s</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- roll_required-3F-source -->
          
        </div>

        

        
      </div><!-- roll_required-3F-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

