<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>common.rl - mail-2.6.3 Documentation</title>

<link type="text/css" media="screen" href="../../../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../../js/darkfish.js"></script>


<body class="file">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../../../index.html">Home</a>
    <a href="../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../../../CHANGELOG_rdoc.html">CHANGELOG</a>
  
    <li class="file"><a href="../../../../CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../../../README_md.html">README</a>
  
    <li class="file"><a href="../../../../TODO_rdoc.html">TODO</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/common_rl.html">common.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/date_time_rl.html">date_time.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/address_lists_machine_rb_rl.html">address_lists_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/content_disposition_machine_rb_rl.html">content_disposition_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/content_location_machine_rb_rl.html">content_location_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/content_transfer_encoding_machine_rb_rl.html">content_transfer_encoding_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/content_type_machine_rb_rl.html">content_type_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/date_time_machine_rb_rl.html">date_time_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/envelope_from_machine_rb_rl.html">envelope_from_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/message_ids_machine_rb_rl.html">message_ids_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/mime_version_machine_rb_rl.html">mime_version_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/phrase_lists_machine_rb_rl.html">phrase_lists_machine.rb.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/rb_actions_rl.html">rb_actions.rl</a>
  
    <li class="file"><a href="../../../../lib/mail/parsers/ragel/ruby/machines/received_machine_rb_rl.html">received_machine.rb.rl</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../../../ActiveSupport.html">ActiveSupport</a>
  
    <li><a href="../../../../Mail.html">Mail</a>
  
    <li><a href="../../../../Mail/Address.html">Mail::Address</a>
  
    <li><a href="../../../../Mail/AddressContainer.html">Mail::AddressContainer</a>
  
    <li><a href="../../../../Mail/AddressList.html">Mail::AddressList</a>
  
    <li><a href="../../../../Mail/AttachmentsList.html">Mail::AttachmentsList</a>
  
    <li><a href="../../../../Mail/BccField.html">Mail::BccField</a>
  
    <li><a href="../../../../Mail/Body.html">Mail::Body</a>
  
    <li><a href="../../../../Mail/CcField.html">Mail::CcField</a>
  
    <li><a href="../../../../Mail/CheckDeliveryParams.html">Mail::CheckDeliveryParams</a>
  
    <li><a href="../../../../Mail/CommentsField.html">Mail::CommentsField</a>
  
    <li><a href="../../../../Mail/CommonAddress.html">Mail::CommonAddress</a>
  
    <li><a href="../../../../Mail/CommonDate.html">Mail::CommonDate</a>
  
    <li><a href="../../../../Mail/CommonField.html">Mail::CommonField</a>
  
    <li><a href="../../../../Mail/CommonMessageId.html">Mail::CommonMessageId</a>
  
    <li><a href="../../../../Mail/Configuration.html">Mail::Configuration</a>
  
    <li><a href="../../../../Mail/Constants.html">Mail::Constants</a>
  
    <li><a href="../../../../Mail/Constants/Encoding.html">Mail::Constants::Encoding</a>
  
    <li><a href="../../../../Mail/ContentDescriptionField.html">Mail::ContentDescriptionField</a>
  
    <li><a href="../../../../Mail/ContentDispositionElement.html">Mail::ContentDispositionElement</a>
  
    <li><a href="../../../../Mail/ContentDispositionField.html">Mail::ContentDispositionField</a>
  
    <li><a href="../../../../Mail/ContentIdField.html">Mail::ContentIdField</a>
  
    <li><a href="../../../../Mail/ContentLocationElement.html">Mail::ContentLocationElement</a>
  
    <li><a href="../../../../Mail/ContentLocationField.html">Mail::ContentLocationField</a>
  
    <li><a href="../../../../Mail/ContentTransferEncodingElement.html">Mail::ContentTransferEncodingElement</a>
  
    <li><a href="../../../../Mail/ContentTransferEncodingField.html">Mail::ContentTransferEncodingField</a>
  
    <li><a href="../../../../Mail/ContentTypeElement.html">Mail::ContentTypeElement</a>
  
    <li><a href="../../../../Mail/ContentTypeField.html">Mail::ContentTypeField</a>
  
    <li><a href="../../../../Mail/DateField.html">Mail::DateField</a>
  
    <li><a href="../../../../Mail/DateTimeElement.html">Mail::DateTimeElement</a>
  
    <li><a href="../../../../Mail/Encodings.html">Mail::Encodings</a>
  
    <li><a href="../../../../Mail/Encodings/Base64.html">Mail::Encodings::Base64</a>
  
    <li><a href="../../../../Mail/Encodings/Binary.html">Mail::Encodings::Binary</a>
  
    <li><a href="../../../../Mail/Encodings/EightBit.html">Mail::Encodings::EightBit</a>
  
    <li><a href="../../../../Mail/Encodings/QuotedPrintable.html">Mail::Encodings::QuotedPrintable</a>
  
    <li><a href="../../../../Mail/Encodings/SevenBit.html">Mail::Encodings::SevenBit</a>
  
    <li><a href="../../../../Mail/Encodings/TransferEncoding.html">Mail::Encodings::TransferEncoding</a>
  
    <li><a href="../../../../Mail/Encodings/UnixToUnix.html">Mail::Encodings::UnixToUnix</a>
  
    <li><a href="../../../../Mail/Envelope.html">Mail::Envelope</a>
  
    <li><a href="../../../../Mail/EnvelopeFromElement.html">Mail::EnvelopeFromElement</a>
  
    <li><a href="../../../../Mail/Exim.html">Mail::Exim</a>
  
    <li><a href="../../../../Mail/Field.html">Mail::Field</a>
  
    <li><a href="../../../../Mail/Field/FieldError.html">Mail::Field::FieldError</a>
  
    <li><a href="../../../../Mail/Field/ParseError.html">Mail::Field::ParseError</a>
  
    <li><a href="../../../../Mail/Field/SyntaxError.html">Mail::Field::SyntaxError</a>
  
    <li><a href="../../../../Mail/FieldList.html">Mail::FieldList</a>
  
    <li><a href="../../../../Mail/FileDelivery.html">Mail::FileDelivery</a>
  
    <li><a href="../../../../Mail/FromField.html">Mail::FromField</a>
  
    <li><a href="../../../../Mail/Header.html">Mail::Header</a>
  
    <li><a href="../../../../Mail/IMAP.html">Mail::IMAP</a>
  
    <li><a href="../../../../Mail/InReplyToField.html">Mail::InReplyToField</a>
  
    <li><a href="../../../../Mail/IndifferentHash.html">Mail::IndifferentHash</a>
  
    <li><a href="../../../../Mail/KeywordsField.html">Mail::KeywordsField</a>
  
    <li><a href="../../../../Mail/Matchers.html">Mail::Matchers</a>
  
    <li><a href="../../../../Mail/Matchers/HasSentEmailMatcher.html">Mail::Matchers::HasSentEmailMatcher</a>
  
    <li><a href="../../../../Mail/Message.html">Mail::Message</a>
  
    <li><a href="../../../../Mail/MessageIdField.html">Mail::MessageIdField</a>
  
    <li><a href="../../../../Mail/MessageIdsElement.html">Mail::MessageIdsElement</a>
  
    <li><a href="../../../../Mail/MimeVersionElement.html">Mail::MimeVersionElement</a>
  
    <li><a href="../../../../Mail/MimeVersionField.html">Mail::MimeVersionField</a>
  
    <li><a href="../../../../Mail/Multibyte.html">Mail::Multibyte</a>
  
    <li><a href="../../../../Mail/Multibyte.html">Mail::Multibyte</a>
  
    <li><a href="../../../../Mail/Multibyte/Chars.html">Mail::Multibyte::Chars</a>
  
    <li><a href="../../../../Mail/Multibyte/EncodingError.html">Mail::Multibyte::EncodingError</a>
  
    <li><a href="../../../../Mail/Multibyte/Unicode.html">Mail::Multibyte::Unicode</a>
  
    <li><a href="../../../../Mail/Multibyte/Unicode/Codepoint.html">Mail::Multibyte::Unicode::Codepoint</a>
  
    <li><a href="../../../../Mail/Multibyte/Unicode/UnicodeDatabase.html">Mail::Multibyte::Unicode::UnicodeDatabase</a>
  
    <li><a href="../../../../Mail/OptionalField.html">Mail::OptionalField</a>
  
    <li><a href="../../../../Mail/POP3.html">Mail::POP3</a>
  
    <li><a href="../../../../Mail/ParameterHash.html">Mail::ParameterHash</a>
  
    <li><a href="../../../../Mail/Parsers.html">Mail::Parsers</a>
  
    <li><a href="../../../../Mail/Parsers/AddressListsParser.html">Mail::Parsers::AddressListsParser</a>
  
    <li><a href="../../../../Mail/Parsers/ContentDispositionParser.html">Mail::Parsers::ContentDispositionParser</a>
  
    <li><a href="../../../../Mail/Parsers/ContentLocationParser.html">Mail::Parsers::ContentLocationParser</a>
  
    <li><a href="../../../../Mail/Parsers/ContentTransferEncodingParser.html">Mail::Parsers::ContentTransferEncodingParser</a>
  
    <li><a href="../../../../Mail/Parsers/ContentTypeParser.html">Mail::Parsers::ContentTypeParser</a>
  
    <li><a href="../../../../Mail/Parsers/DateTimeParser.html">Mail::Parsers::DateTimeParser</a>
  
    <li><a href="../../../../Mail/Parsers/EnvelopeFromParser.html">Mail::Parsers::EnvelopeFromParser</a>
  
    <li><a href="../../../../Mail/Parsers/MessageIdsParser.html">Mail::Parsers::MessageIdsParser</a>
  
    <li><a href="../../../../Mail/Parsers/MimeVersionParser.html">Mail::Parsers::MimeVersionParser</a>
  
    <li><a href="../../../../Mail/Parsers/PhraseListsParser.html">Mail::Parsers::PhraseListsParser</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel.html">Mail::Parsers::Ragel</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/AddressListsMachine.html">Mail::Parsers::Ragel::AddressListsMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/ContentDispositionMachine.html">Mail::Parsers::Ragel::ContentDispositionMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/ContentLocationMachine.html">Mail::Parsers::Ragel::ContentLocationMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/ContentTransferEncodingMachine.html">Mail::Parsers::Ragel::ContentTransferEncodingMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/ContentTypeMachine.html">Mail::Parsers::Ragel::ContentTypeMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/DateTimeMachine.html">Mail::Parsers::Ragel::DateTimeMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/EnvelopeFromMachine.html">Mail::Parsers::Ragel::EnvelopeFromMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/MessageIdsMachine.html">Mail::Parsers::Ragel::MessageIdsMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/MimeVersionMachine.html">Mail::Parsers::Ragel::MimeVersionMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/PhraseListsMachine.html">Mail::Parsers::Ragel::PhraseListsMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/ReceivedMachine.html">Mail::Parsers::Ragel::ReceivedMachine</a>
  
    <li><a href="../../../../Mail/Parsers/Ragel/Ruby.html">Mail::Parsers::Ragel::Ruby</a>
  
    <li><a href="../../../../Mail/Parsers/ReceivedParser.html">Mail::Parsers::ReceivedParser</a>
  
    <li><a href="../../../../Mail/Part.html">Mail::Part</a>
  
    <li><a href="../../../../Mail/PartsList.html">Mail::PartsList</a>
  
    <li><a href="../../../../Mail/PhraseList.html">Mail::PhraseList</a>
  
    <li><a href="../../../../Mail/ReceivedElement.html">Mail::ReceivedElement</a>
  
    <li><a href="../../../../Mail/ReceivedField.html">Mail::ReceivedField</a>
  
    <li><a href="../../../../Mail/ReferencesField.html">Mail::ReferencesField</a>
  
    <li><a href="../../../../Mail/ReplyToField.html">Mail::ReplyToField</a>
  
    <li><a href="../../../../Mail/ResentBccField.html">Mail::ResentBccField</a>
  
    <li><a href="../../../../Mail/ResentCcField.html">Mail::ResentCcField</a>
  
    <li><a href="../../../../Mail/ResentDateField.html">Mail::ResentDateField</a>
  
    <li><a href="../../../../Mail/ResentFromField.html">Mail::ResentFromField</a>
  
    <li><a href="../../../../Mail/ResentMessageIdField.html">Mail::ResentMessageIdField</a>
  
    <li><a href="../../../../Mail/ResentSenderField.html">Mail::ResentSenderField</a>
  
    <li><a href="../../../../Mail/ResentToField.html">Mail::ResentToField</a>
  
    <li><a href="../../../../Mail/Retriever.html">Mail::Retriever</a>
  
    <li><a href="../../../../Mail/ReturnPathField.html">Mail::ReturnPathField</a>
  
    <li><a href="../../../../Mail/Ruby18.html">Mail::Ruby18</a>
  
    <li><a href="../../../../Mail/Ruby19.html">Mail::Ruby19</a>
  
    <li><a href="../../../../Mail/Ruby19/BestEffortCharsetEncoder.html">Mail::Ruby19::BestEffortCharsetEncoder</a>
  
    <li><a href="../../../../Mail/Ruby19/StrictCharsetEncoder.html">Mail::Ruby19::StrictCharsetEncoder</a>
  
    <li><a href="../../../../Mail/SMTP.html">Mail::SMTP</a>
  
    <li><a href="../../../../Mail/SMTPConnection.html">Mail::SMTPConnection</a>
  
    <li><a href="../../../../Mail/SenderField.html">Mail::SenderField</a>
  
    <li><a href="../../../../Mail/Sendmail.html">Mail::Sendmail</a>
  
    <li><a href="../../../../Mail/StructuredField.html">Mail::StructuredField</a>
  
    <li><a href="../../../../Mail/SubjectField.html">Mail::SubjectField</a>
  
    <li><a href="../../../../Mail/TestMailer.html">Mail::TestMailer</a>
  
    <li><a href="../../../../Mail/TestRetriever.html">Mail::TestRetriever</a>
  
    <li><a href="../../../../Mail/ToField.html">Mail::ToField</a>
  
    <li><a href="../../../../Mail/UnknownEncodingType.html">Mail::UnknownEncodingType</a>
  
    <li><a href="../../../../Mail/UnstructuredField.html">Mail::UnstructuredField</a>
  
    <li><a href="../../../../Mail/Utilities.html">Mail::Utilities</a>
  
    <li><a href="../../../../Mail/VERSION.html">Mail::VERSION</a>
  
    <li><a href="../../../../Net.html">Net</a>
  
    <li><a href="../../../../Net/SMTP.html">Net::SMTP</a>
  
    <li><a href="../../../../NilClass.html">NilClass</a>
  
    <li><a href="../../../../Object.html">Object</a>
  
    <li><a href="../../../../String.html">String</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">
  
<p>%%{</p>

<pre>machine common;

action comment_begin { fcall comment_tail; }
action comment_exit { fret; }

# RFC5322: address_lists, date_time, message_ids, phrase_lists, received

obs_NO_WS_CTL = 0x01..0x08 | 0x0b | 0x0c | 0x0e..0x1f | 0x7f;
LF = &quot;\n&quot;;
CR = &quot;\r&quot;;
CRLF = &quot;\r\n&quot;;
WSP = 0x09 | 0x20;
obs_ctext = obs_NO_WS_CTL;
VCHAR = 0x21..0x7e;
obs_qp = &quot;\\&quot; (0x00 | obs_NO_WS_CTL | LF | CR);
obs_FWS = (CRLF? WSP)+;
ctext = 0x21..0x27 | 0x2a..0x5b | 0x5d..0x7e | obs_ctext;
quoted_pair = (&quot;\\&quot; (VCHAR | WSP)) | obs_qp;
FWS = (WSP* CRLF WSP+) | (CRLF WSP+) | obs_FWS;
ALPHA = [a-zA-Z];
DIGIT = [0-9];
DQUOTE = &#39;&quot;&#39;;
obs_qtext = obs_NO_WS_CTL;
atext = ALPHA | DIGIT | &quot;!&quot; | &quot;#&quot; | &quot;$&quot; | &quot;%&quot; | &quot;&amp;&quot; |
        &quot;&#39;&quot; | &quot;*&quot; | &quot;+&quot; | &quot;-&quot; | &quot;/&quot; | &quot;=&quot; | &quot;?&quot; | &quot;^&quot; |
        &quot;_&quot; | &quot;`&quot; | &quot;{&quot; | &quot;|&quot; | &quot;}&quot; | &quot;~&quot;;
qtext = 0x21 | 0x23..0x5b | 0x5d..0x7e | obs_qtext;
obs_dtext = obs_NO_WS_CTL | quoted_pair;
qcontent = qtext | quoted_pair;

# Handle recursive comments
ccontent = ctext | quoted_pair | &quot;(&quot; @comment_begin;
comment_tail := ((FWS? ccontent)* &gt;comment_s) FWS? &quot;)&quot; @comment_exit;
comment = &quot;(&quot; @comment_begin %comment_e;
CFWS = ((FWS? comment)+ FWS?) | FWS;

quoted_string = CFWS?
                (DQUOTE
                  (((FWS? qcontent)* FWS?) &gt;qstr_s %qstr_e)
                DQUOTE)
                CFWS?;

atom = CFWS? atext+ CFWS?;
word = atom | quoted_string;

# phrase_lists
obs_phrase = (word | &quot;.&quot; | &quot;@&quot;)+;
phrase = (obs_phrase | word+) &gt;phrase_s %phrase_e;
phrase_lists = phrase (&quot;,&quot; FWS* phrase)*;

# address_lists

# local_part:
domain_text = (DQUOTE (FWS? qcontent)+ FWS? DQUOTE) | atext+;
local_dot_atom_text = (&quot;.&quot;* domain_text &quot;.&quot;*)+;
local_dot_atom = CFWS?
                 (local_dot_atom_text &gt;local_dot_atom_s %local_dot_atom_pre_comment_e)
                 CFWS?;
obs_local_part = word (&quot;.&quot; word)*;
local_part = (local_dot_atom &gt;local_dot_atom_s %local_dot_atom_e |
              (quoted_string %local_quoted_string_e) |
              obs_local_part);

# Treetop parser behavior was to ignore addresses missing &#39;@&#39; inside of angle
# brackets. This construction preserves that behavior.
local_part_no_capture = (local_dot_atom | quoted_string | obs_local_part);

# domain:
dot_atom_text = &quot;.&quot;* domain_text (&quot;.&quot;* domain_text)*;
dtext = 0x21..0x5a | 0x5e..0x7e | obs_dtext;
dot_atom = CFWS? dot_atom_text (CFWS? &gt;(comment_after_address,1));
domain_literal = CFWS? &quot;[&quot; (FWS? dtext)* FWS? &quot;]&quot; CFWS?;
obs_domain = atom (&quot;.&quot; atom)*;
domain = (dot_atom | domain_literal | obs_domain) &gt;domain_s %domain_e;

# addr_spec:

# The %(end_addr,N) priority resolves uncertainty when whitespace
# after an addr_spec could cause it to be interpreted as a
# display name: &quot;bar@example.com ,...&quot;

addr_spec_in_angle_brackets =
  (local_part &quot;@&quot; domain) %(end_addr,1) |
  local_part_no_capture   %(end_addr,0);

addr_spec_no_angle_brackets =
  (local_part &quot;@&quot; domain) %(end_addr,1) |
  local_part              %(end_addr,0);

# angle_addr:
obs_domain_list = (CFWS | &quot;,&quot;)* &quot;@&quot; domain (&quot;,&quot; CFWS? (&quot;@&quot; domain)?)*;
obs_route = (obs_domain_list &quot;:&quot;) &gt;obs_domain_list_s %obs_domain_list_e;
obs_angle_addr = CFWS? &quot;&lt;&quot; obs_route? addr_spec_in_angle_brackets &quot;&gt;&quot; CFWS?;

angle_addr = CFWS? (&quot;&lt;&quot; &gt;angle_addr_s) addr_spec_in_angle_brackets &quot;&gt;&quot; CFWS? |
              obs_angle_addr;

# Address
display_name = phrase;
name_addr = display_name? %(end_addr,2) angle_addr;
mailbox = (name_addr | addr_spec_no_angle_brackets) &gt;address_s %address_e;
obs_mbox_list = (CFWS? &quot;,&quot;)* mailbox (&quot;,&quot; (mailbox | CFWS)?)*;
mailbox_list = (mailbox ((&quot;,&quot; | &quot;;&quot;) mailbox)*) | obs_mbox_list;
obs_group_list = (CFWS? &quot;,&quot;)+ CFWS?;
group_list = mailbox_list | CFWS | obs_group_list;
group = (display_name &gt;group_name_s %group_name_e) &quot;:&quot;
          (group_list?) &quot;;&quot; CFWS?;
address = group | mailbox;
#obs_addr_list = (CFWS? &quot;,&quot;)* address (&quot;,&quot; (address | CFWS)?)*;
address_lists = address? %(comment_after_address,0)
                (FWS* (&quot;,&quot; | &quot;;&quot;) FWS* address?)*;

# message_ids
obs_id_left = local_part;
id_left = dot_atom_text | obs_id_left;
# id_right modifications to support multiple &#39;@&#39; in msg_id.
msg_id_atext = ALPHA | DIGIT | &quot;!&quot; | &quot;#&quot; | &quot;$&quot; | &quot;%&quot; | &quot;&amp;&quot; | &quot;&#39;&quot; | &quot;*&quot; |
               &quot;+&quot; | &quot;-&quot; | &quot;/&quot; | &quot;=&quot; | &quot;?&quot; | &quot;^&quot; | &quot;_&quot; | &quot;`&quot; | &quot;{&quot; | &quot;|&quot; |
               &quot;}&quot; | &quot;~&quot; | &quot;@&quot;;
msg_id_dot_atom_text = (msg_id_atext+ &quot;.&quot;?)+;
obs_id_right = domain;
no_fold_literal = &quot;[&quot; (dtext)* &quot;]&quot;;
id_right = msg_id_dot_atom_text | no_fold_literal | obs_id_right;
msg_id = (CFWS)?
         ((&quot;&lt;&quot; id_left &quot;@&quot; id_right &quot;&gt;&quot;) &gt;msg_id_s %msg_id_e)
         (CFWS)?;
message_ids = msg_id (CFWS? msg_id)*;

include date_time &quot;date_time.rl&quot;;
date_time = (day_of_week &quot;,&quot;)?
            (date &gt;date_s %date_e) &lt;: (time &gt;time_s %time_e) CFWS?;

# Added CFWS? to increase robustness
# (qmail likes to include a comment style string...?)
received_token = word | angle_addr | addr_spec_no_angle_brackets | domain;
received = ((CFWS? received_token*) &gt;received_tokens_s %received_tokens_e)
            &quot;;&quot; date_time;

# RFC2045: mime_version, content_type, content_transfer_encoding
mime_version = CFWS?
          (DIGIT+ &gt;major_digits_s %major_digits_e)
          comment? &quot;.&quot; comment?
          (DIGIT+ &gt;minor_digits_s %minor_digits_e)
          CFWS?;

token = 0x21..0x27 | 0x2a..0x2b | 0x2c..0x2e |
        0x30..0x39 | 0x41..0x5a | 0x5e..0x7e;
value = (quoted_string | (token -- &#39;&quot;&#39; | 0x3d)+) &gt;param_val_s %param_val_e;
attribute = (token+) &gt;param_attr_s %param_attr_e;
parameter = CFWS? attribute &quot;=&quot; value CFWS?;

ietf_token = token+;
custom_x_token = &#39;x&#39;i &quot;-&quot; token+;
extension_token = ietf_token | custom_x_token;
discrete_type = &#39;text&#39;i | &#39;image&#39;i | &#39;audio&#39;i | &#39;video&#39;i |
                &#39;application&#39;i | extension_token;
composite_type = &#39;message&#39;i | &#39;multipart&#39;i | extension_token;
iana_token = token+;
main_type = (discrete_type | composite_type) &gt;main_type_s %main_type_e;
sub_type = (extension_token | iana_token) &gt;sub_type_s %sub_type_e;
content_type = main_type &quot;/&quot; sub_type (((CFWS? &quot;;&quot;+) | CFWS) parameter CFWS?)*;

encoding = (&#39;7bits&#39; | &#39;8bits&#39; | &#39;7bit&#39; | &#39;8bit&#39; | &#39;binary&#39; |
            &#39;quoted-printable&#39; | &#39;base64&#39; | ietf_token |
            custom_x_token) &gt;encoding_s %encoding_e;
content_transfer_encoding = CFWS? encoding CFWS? &quot;;&quot;? CFWS?;

# RFC2183: content_disposition
# TODO: recognize filename, size, creation date, etc.
disposition_type = &#39;inline&#39;i | &#39;attachment&#39;i | extension_token | &#39;&#39;;
content_disposition = (disposition_type &gt;disp_type_s %disp_type_e)
                      (CFWS? &quot;;&quot; parameter CFWS?)*;

# Envelope From
ctime_date = day_name &quot; &quot;+ month &quot; &quot;+ day &quot; &quot; time_of_day &quot; &quot; year;
null_sender = (&#39;&lt;&gt;&#39; &#39; &#39;{0,1});
envelope_from = (addr_spec_no_angle_brackets | null_sender) &gt;address_s %address_e &quot; &quot;
                (ctime_date &gt;ctime_date_s %ctime_date_e);

# content_location
location = quoted_string | ((token | 0x3d)+ &gt;token_string_s %token_string_e);
content_location = CFWS? location CFWS?;</pre>

<p>}%%</p>

</div>



<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

