<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class DirectoryWatcher::Collector - directory_watcher-1.5.1 Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/directory_watcher/collector.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="Threaded.html">DirectoryWatcher::Threaded</a>
  
  
  
    <li><a class="include" href="Logable.html">DirectoryWatcher::Logable</a>
  
  
  </ul>
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-collection_queue">#collection_queue</a>
    
    <li ><a href="#method-i-dump_stats">#dump_stats</a>
    
    <li ><a href="#method-i-emit_event_for">#emit_event_for</a>
    
    <li ><a href="#method-i-emit_removed_events">#emit_removed_events</a>
    
    <li ><a href="#method-i-emitting_stable_events-3F">#emitting_stable_events?</a>
    
    <li ><a href="#method-i-increment_stable_count">#increment_stable_count</a>
    
    <li ><a href="#method-i-load_stats">#load_stats</a>
    
    <li ><a href="#method-i-mark_as_invalid_for_stable_event">#mark_as_invalid_for_stable_event</a>
    
    <li ><a href="#method-i-mark_as_valid_for_stable_event">#mark_as_valid_for_stable_event</a>
    
    <li ><a href="#method-i-notification_queue">#notification_queue</a>
    
    <li ><a href="#method-i-on_scan">#on_scan</a>
    
    <li ><a href="#method-i-on_stat">#on_stat</a>
    
    <li ><a href="#method-i-order_by">#order_by</a>
    
    <li ><a href="#method-i-run">#run</a>
    
    <li ><a href="#method-i-should_emit-3F">#should_emit?</a>
    
    <li ><a href="#method-i-should_emit_stable-3F">#should_emit_stable?</a>
    
    <li ><a href="#method-i-sort_by">#sort_by</a>
    
    <li ><a href="#method-i-sorted_stats">#sorted_stats</a>
    
    <li ><a href="#method-i-stable_threshold">#stable_threshold</a>
    
    <li ><a href="#method-i-update_stat">#update_stat</a>
    
    <li ><a href="#method-i-valid_for_stable_event-3F">#valid_for_stable_event?</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../History_txt.html">History</a>
  
    <li class="file"><a href="../README_txt.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../DirectoryWatcher.html">DirectoryWatcher</a>
  
    <li><a href="../DirectoryWatcher/Collector.html">DirectoryWatcher::Collector</a>
  
    <li><a href="../DirectoryWatcher/Configuration.html">DirectoryWatcher::Configuration</a>
  
    <li><a href="../DirectoryWatcher/CoolioScanner.html">DirectoryWatcher::CoolioScanner</a>
  
    <li><a href="../DirectoryWatcher/EmScanner.html">DirectoryWatcher::EmScanner</a>
  
    <li><a href="../DirectoryWatcher/Event.html">DirectoryWatcher::Event</a>
  
    <li><a href="../DirectoryWatcher/EventableScanner.html">DirectoryWatcher::EventableScanner</a>
  
    <li><a href="../DirectoryWatcher/FileStat.html">DirectoryWatcher::FileStat</a>
  
    <li><a href="../DirectoryWatcher/Logable.html">DirectoryWatcher::Logable</a>
  
    <li><a href="../DirectoryWatcher/Notifier.html">DirectoryWatcher::Notifier</a>
  
    <li><a href="../DirectoryWatcher/NullLogger.html">DirectoryWatcher::NullLogger</a>
  
    <li><a href="../DirectoryWatcher/Paths.html">DirectoryWatcher::Paths</a>
  
    <li><a href="../DirectoryWatcher/RevScanner.html">DirectoryWatcher::RevScanner</a>
  
    <li><a href="../DirectoryWatcher/Scan.html">DirectoryWatcher::Scan</a>
  
    <li><a href="../DirectoryWatcher/ScanAndQueue.html">DirectoryWatcher::ScanAndQueue</a>
  
    <li><a href="../DirectoryWatcher/Scanner.html">DirectoryWatcher::Scanner</a>
  
    <li><a href="../DirectoryWatcher/Threaded.html">DirectoryWatcher::Threaded</a>
  
    <li><a href="../DirectoryWatcher/Version.html">DirectoryWatcher::Version</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class DirectoryWatcher::Collector</h1>

  <div id="description" class="description">
    
<p><a href="Collector.html">Collector</a> reads items from a collection Queue
and processes them to see if FileEvents should be put onto the notification
Queue.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( config )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <pre>Create a new StatCollector from the given Configuration, and an optional
Scan.

configuration - The Collector uses from Configuration:
  collection_queue   - The Queue to read items from the Scanner on
  notification_queue - The Queue to submit the Events to the Notifier on
  stable             - The number of times we see a file hasn&#39;t changed before
                       emitting a stable event
  sort_by            - the method used to sort events during on_scan results
  order_by           - The method used to order events from call to on_scan

pre_load_scan - A Scan to use to load our internal state from before. No
                events will be emitted for the FileStat&#39;s in this scan.</pre>

<p>def initialize( <a
href="Collector.html#method-i-notification_queue">#notification_queue</a>,
<a href="Collector.html#method-i-collection_queue">#collection_queue</a>,
options = {} )</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">config</span> )
  <span class="ruby-ivar">@stats</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@stable_counts</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">config</span>
  <span class="ruby-identifier">on_scan</span>( <span class="ruby-constant">DirectoryWatcher</span><span class="ruby-operator">::</span><span class="ruby-constant">Scan</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">config</span>.<span class="ruby-identifier">glob</span> ), <span class="ruby-keyword">false</span> ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">pre_load?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">interval</span> = <span class="ruby-value">0.01</span> <span class="ruby-comment"># yes this is a fast loop</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-collection_queue" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">collection_queue</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The queue from which to read items from the scanners. See Configuration.</p>
          
          

          
          <div class="method-source-code" id="collection_queue-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">collection_queue</span>
  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">collection_queue</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- collection_queue-source -->
          
        </div>

        

        
      </div><!-- collection_queue-method -->

    
      <div id="method-i-dump_stats" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dump_stats</span><span
            class="method-args">( io )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Write the current stats to the given IO object as a YAML document.</p>

<p>io - The IO object to write the document to.</p>

<p>Returns nothing.</p>
          
          

          
          <div class="method-source-code" id="dump_stats-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dump_stats</span>( <span class="ruby-identifier">io</span> )
  <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-ivar">@stats</span>, <span class="ruby-identifier">io</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- dump_stats-source -->
          
        </div>

        

        
      </div><!-- dump_stats-method -->

    
      <div id="method-i-load_stats" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_stats</span><span
            class="method-args">( io )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Read the current stats from the given IO object. Any existing stats in the
<a href="Collector.html">Collector</a> will be overwritten</p>

<p>io - The IO object from which to read the document.</p>

<p>Returns nothing.</p>
          
          

          
          <div class="method-source-code" id="load_stats-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_stats</span>( <span class="ruby-identifier">io</span> )
  <span class="ruby-ivar">@stats</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">io</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_stats-source -->
          
        </div>

        

        
      </div><!-- load_stats-method -->

    
      <div id="method-i-notification_queue" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">notification_queue</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The queue to write Events for the Notifier. See Configuration.</p>
          
          

          
          <div class="method-source-code" id="notification_queue-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 57</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notification_queue</span>
  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">notification_queue</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- notification_queue-source -->
          
        </div>

        

        
      </div><!-- notification_queue-method -->

    
      <div id="method-i-on_scan" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">on_scan</span><span
            class="method-args">( scan, emit_events = true )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Given the scan, update the set of stats with the results from the Scan and
emit events to the notification queue as appropriate.</p>

<p>scan        - The Scan containing all the new FileStat items emit_events -
Should events be emitted for the events in the scan</p>

<pre>(default: true)</pre>

<p>There is one odd thing that happens here. Scanners that are
EventableScanners use <a
href="Collector.html#method-i-on_stat">#on_stat</a> to emit removed events,
and the standard threaded Scanner only uses Scans. So we make sure and only
emit removed events in this method if the scanner that gave us the scan was
the basic threaded Scanner.</p>

<p>TODO: Possibly fix this through another abstraction in the Scanners. No
idea about what that would be yet.</p>

<p>Returns nothing.</p>
          
          

          
          <div class="method-source-code" id="on_scan-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">on_scan</span>( <span class="ruby-identifier">scan</span>, <span class="ruby-identifier">emit_events</span> = <span class="ruby-keyword">true</span> )
  <span class="ruby-identifier">seen_paths</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Sorting by #{sort_by} #{order_by}&quot;</span>
  <span class="ruby-identifier">sorted_stats</span>( <span class="ruby-identifier">scan</span>.<span class="ruby-identifier">run</span> ).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">stat</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">on_stat</span>(<span class="ruby-identifier">stat</span>, <span class="ruby-identifier">emit_events</span>)
    <span class="ruby-identifier">seen_paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">emit_removed_events</span>(<span class="ruby-identifier">seen_paths</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- on_scan-source -->
          
        </div>

        

        
      </div><!-- on_scan-method -->

    
      <div id="method-i-on_stat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">on_stat</span><span
            class="method-args">( stat, emit_event = true )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Process a single stat and emit an event if necessary.</p>

<p>stat       - The new FileStat to process and see if an event should</p>

<pre>be emitted</pre>

<p>emit_event - Whether or not an event should be emitted.</p>

<p>Returns nothing</p>
          
          

          
          <div class="method-source-code" id="on_stat-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">on_stat</span>( <span class="ruby-identifier">stat</span>, <span class="ruby-identifier">emit_event</span> = <span class="ruby-keyword">true</span> )
  <span class="ruby-identifier">orig_stat</span> = <span class="ruby-identifier">update_stat</span>( <span class="ruby-identifier">stat</span> )
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Emitting event for on_stat #{stat}&quot;</span>
  <span class="ruby-identifier">emit_event_for</span>( <span class="ruby-identifier">orig_stat</span>, <span class="ruby-identifier">stat</span> ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">emit_event</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- on_stat-source -->
          
        </div>

        

        
      </div><!-- on_stat-method -->

    
      <div id="method-i-order_by" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order_by</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>How to order Scan results. See Configuration.</p>
          
          

          
          <div class="method-source-code" id="order_by-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">order_by</span>
  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">order_by</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- order_by-source -->
          
        </div>

        

        
      </div><!-- order_by-method -->

    
      <div id="method-i-run" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Remove one item from the collection queue and process it.</p>

<p>This method is required by the Threaded API</p>

<p>Returns nothing</p>
          
          

          
          <div class="method-source-code" id="run-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">thing</span> = <span class="ruby-identifier">collection_queue</span>.<span class="ruby-identifier">deq</span>
  <span class="ruby-keyword">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">DirectoryWatcher</span><span class="ruby-operator">::</span><span class="ruby-constant">Scan</span>
    <span class="ruby-identifier">on_scan</span>(<span class="ruby-identifier">thing</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">DirectoryWatcher</span><span class="ruby-operator">::</span><span class="ruby-constant">FileStat</span>
    <span class="ruby-identifier">on_stat</span>(<span class="ruby-identifier">thing</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown item in the queue: #{thing}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- run-source -->
          
        </div>

        

        
      </div><!-- run-method -->

    
      <div id="method-i-sort_by" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sort_by</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>How to sort Scan results. See Configuration.</p>
          
          

          
          <div class="method-source-code" id="sort_by-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sort_by</span>
  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">sort_by</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sort_by-source -->
          
        </div>

        

        
      </div><!-- sort_by-method -->

    
      <div id="method-i-stable_threshold" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stable_threshold</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The number of times we see a file hasn&#39;t changed before emitting a
stable count. See Configuration#stable</p>
          
          

          
          <div class="method-source-code" id="stable_threshold-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stable_threshold</span>
  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">stable</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- stable_threshold-source -->
          
        </div>

        

        
      </div><!-- stable_threshold-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-emit_event_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emit_event_for</span><span
            class="method-args">( old_stat, new_stat )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Determine what type of event to emit, and put that event onto the
notification queue.</p>

<p>old_stat - The old FileStat new_stat - The new FileStat</p>

<p>Returns nothing</p>
          
          

          
          <div class="method-source-code" id="emit_event_for-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emit_event_for</span>( <span class="ruby-identifier">old_stat</span>, <span class="ruby-identifier">new_stat</span> )
  <span class="ruby-identifier">event</span> = <span class="ruby-constant">DirectoryWatcher</span><span class="ruby-operator">::</span><span class="ruby-constant">Event</span>.<span class="ruby-identifier">from_stats</span>( <span class="ruby-identifier">old_stat</span>, <span class="ruby-identifier">new_stat</span> )
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_emit?</span>(<span class="ruby-identifier">event</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Sending event #{event.object_id} to notifcation queue&quot;</span>
    <span class="ruby-identifier">notification_queue</span>.<span class="ruby-identifier">enq</span>( <span class="ruby-identifier">event</span> )
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Emitting of event #{event.object_id} cancelled&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emit_event_for-source -->
          
        </div>

        

        
      </div><!-- emit_event_for-method -->

    
      <div id="method-i-emit_removed_events" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emit_removed_events</span><span
            class="method-args">( seen_paths )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Look for removed files and emit removed events for all of them.</p>

<p>seen_paths - the list of files that we know currently exist</p>

<p>Return nothing</p>
          
          

          
          <div class="method-source-code" id="emit_removed_events-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emit_removed_events</span>( <span class="ruby-identifier">seen_paths</span> )
  <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">existing_path</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">seen_paths</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">existing_path</span>)
    <span class="ruby-identifier">old_stat</span> = <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">existing_path</span>)
    <span class="ruby-identifier">emit_event_for</span>(<span class="ruby-identifier">old_stat</span>, <span class="ruby-operator">::</span><span class="ruby-constant">DirectoryWatcher</span><span class="ruby-operator">::</span><span class="ruby-constant">FileStat</span>.<span class="ruby-identifier">for_removed_path</span>(<span class="ruby-identifier">existing_path</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emit_removed_events-source -->
          
        </div>

        

        
      </div><!-- emit_removed_events-method -->

    
      <div id="method-i-emitting_stable_events-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emitting_stable_events?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is it legal for us to emit stable events at all. This checks the config to
see if that is the case.</p>

<p>In the @config if the stable threshold is set then we are emitting stable
events.</p>

<p>Returns whether it is legal to propogate stable events</p>
          
          

          
          <div class="method-source-code" id="emitting_stable_events-3F-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emitting_stable_events?</span>
  <span class="ruby-identifier">stable_threshold</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emitting_stable_events-3F-source -->
          
        </div>

        

        
      </div><!-- emitting_stable_events-3F-method -->

    
      <div id="method-i-increment_stable_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">increment_stable_count</span><span
            class="method-args">( path )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Increment the stable count for the given path</p>

<p>path - the path of the file to increment its stable count</p>

<p>Returns nothing</p>
          
          

          
          <div class="method-source-code" id="increment_stable_count-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">increment_stable_count</span>( <span class="ruby-identifier">path</span> )
  <span class="ruby-ivar">@stable_counts</span>[<span class="ruby-identifier">path</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- increment_stable_count-source -->
          
        </div>

        

        
      </div><!-- increment_stable_count-method -->

    
      <div id="method-i-mark_as_invalid_for_stable_event" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mark_as_invalid_for_stable_event</span><span
            class="method-args">( path )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Mark that the given path is invalid for having a stable event emitted for
it.</p>

<p>path - the path to mark</p>

<p>Returns nothing</p>
          
          

          
          <div class="method-source-code" id="mark_as_invalid_for_stable_event-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mark_as_invalid_for_stable_event</span>( <span class="ruby-identifier">path</span> )
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;#{path} marked as invalid for stable&quot;</span>
  <span class="ruby-ivar">@stable_counts</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-identifier">path</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- mark_as_invalid_for_stable_event-source -->
          
        </div>

        

        
      </div><!-- mark_as_invalid_for_stable_event-method -->

    
      <div id="method-i-mark_as_valid_for_stable_event" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mark_as_valid_for_stable_event</span><span
            class="method-args">( path )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Let it be known that the given path can now have a stable event emitted for
it.</p>

<p>path - the path to mark as ready</p>

<p>Returns nothing</p>
          
          

          
          <div class="method-source-code" id="mark_as_valid_for_stable_event-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mark_as_valid_for_stable_event</span>( <span class="ruby-identifier">path</span> )
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;#{path} marked as valid for stable&quot;</span>
  <span class="ruby-ivar">@stable_counts</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- mark_as_valid_for_stable_event-source -->
          
        </div>

        

        
      </div><!-- mark_as_valid_for_stable_event-method -->

    
      <div id="method-i-should_emit-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">should_emit?</span><span
            class="method-args">( event )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Should the event given actually be emitted.</p>

<p>If the event passed in is NOT a stable event, return true If there is a <a
href="Collector.html#method-i-stable_threshold">#stable_threshold</a>, then
check to see if the stable count for this event&#39;s path has crossed the
stable threshold.</p>

<p>This method has the side effect of updating the stable count of the path of
the event. If we are going to return true for the stable event, then we
reset the stable count of that event to 0.</p>

<p>event - any event</p>

<p>Returns whether or not to emit the event based upon its stability</p>
          
          

          
          <div class="method-source-code" id="should_emit-3F-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">should_emit?</span>( <span class="ruby-identifier">event</span> )
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">stable?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">emitting_stable_events?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">valid_for_stable_event?</span>( <span class="ruby-identifier">event</span>.<span class="ruby-identifier">path</span> )<span class="ruby-keyword">then</span>
      <span class="ruby-identifier">increment_stable_count</span>( <span class="ruby-identifier">event</span>.<span class="ruby-identifier">path</span> )
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_emit_stable?</span>( <span class="ruby-identifier">event</span>.<span class="ruby-identifier">path</span> ) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">mark_as_invalid_for_stable_event</span>( <span class="ruby-identifier">event</span>.<span class="ruby-identifier">path</span> )
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">removed?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">mark_as_invalid_for_stable_event</span>( <span class="ruby-identifier">event</span>.<span class="ruby-identifier">path</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">mark_as_valid_for_stable_event</span>( <span class="ruby-identifier">event</span>.<span class="ruby-identifier">path</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- should_emit-3F-source -->
          
        </div>

        

        
      </div><!-- should_emit-3F-method -->

    
      <div id="method-i-should_emit_stable-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">should_emit_stable?</span><span
            class="method-args">( path )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is the given path ready to have a stable event emitted?</p>

<p>path - the path to report on</p>

<p>Returns whether to emit a stable event or not</p>
          
          

          
          <div class="method-source-code" id="should_emit_stable-3F-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 269</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">should_emit_stable?</span>( <span class="ruby-identifier">path</span> )
  <span class="ruby-ivar">@stable_counts</span>[<span class="ruby-identifier">path</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">stable_threshold</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- should_emit_stable-3F-source -->
          
        </div>

        

        
      </div><!-- should_emit_stable-3F-method -->

    
      <div id="method-i-sorted_stats" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sorted_stats</span><span
            class="method-args">( stats )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sort the stats by <code>sort_by</code> and <code>order_by</code> returning
the results</p>
          
          

          
          <div class="method-source-code" id="sorted_stats-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sorted_stats</span>( <span class="ruby-identifier">stats</span> )
  <span class="ruby-identifier">sorted</span> = <span class="ruby-identifier">stats</span>.<span class="ruby-identifier">sort_by</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">stat</span><span class="ruby-operator">|</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">sort_by</span>) }
  <span class="ruby-identifier">sorted</span> = <span class="ruby-identifier">sorted</span>.<span class="ruby-identifier">reverse</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">order_by</span> <span class="ruby-operator">==</span> <span class="ruby-value">:descending</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">sorted</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sorted_stats-source -->
          
        </div>

        

        
      </div><!-- sorted_stats-method -->

    
      <div id="method-i-update_stat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_stat</span><span
            class="method-args">( new_stat )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update the stats Hash with the new_stat information, return the old data
that is being replaced.</p>
          
          

          
          <div class="method-source-code" id="update_stat-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_stat</span>( <span class="ruby-identifier">new_stat</span> )
  <span class="ruby-identifier">old_stat</span> = <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">new_stat</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">new_stat</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">new_stat</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">new_stat</span>.<span class="ruby-identifier">removed?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">old_stat</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_stat-source -->
          
        </div>

        

        
      </div><!-- update_stat-method -->

    
      <div id="method-i-valid_for_stable_event-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">valid_for_stable_event?</span><span
            class="method-args">( path )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is the given path able to have a stable event emitted for it?</p>

<p>A stable event may only be emitted for a path that has already had an added
or modified event already sent. Also, once a stable event has been emitted
for a path, another stable event may not be emitted until it has been
modified, or added again.</p>

<p>path - the path of the file to check</p>

<p>Returns whether or not the path may have a stable event emitted for it.</p>
          
          

          
          <div class="method-source-code" id="valid_for_stable_event-3F-source">
            <pre><span class="ruby-comment"># File lib/directory_watcher/collector.rb, line 229</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">valid_for_stable_event?</span>( <span class="ruby-identifier">path</span> )
  <span class="ruby-ivar">@stable_counts</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-identifier">path</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- valid_for_stable_event-3F-source -->
          
        </div>

        

        
      </div><!-- valid_for_stable_event-3F-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

