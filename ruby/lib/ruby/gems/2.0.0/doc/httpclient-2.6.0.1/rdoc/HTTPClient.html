<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class HTTPClient - httpclient-2.6.0.1 Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  
<div id="table-of-contents">
  <nav class="section">
    <h3 class="section-header">Table of Contents</h3>
    <ul>
      <li><a href="#label-How+to+use">How to use</a>
      <li><a href="#label-How+to+retrieve+web+resources">How to retrieve web resources</a>
      <li><a href="#label-Invoking+other+HTTP+methods">Invoking other HTTP methods</a>
      <li><a href="#label-How+to+POST">How to POST</a>
      <li><a href="#label-Accessing+via+SSL">Accessing via SSL</a>
      <li><a href="#label-Handling+Cookies">Handling Cookies</a>
      <li><a href="#label-Configuring+authentication+credentials">Configuring authentication credentials</a>
      <li><a href="#label-Invoking+HTTP+methods+with+custom+header">Invoking HTTP methods with custom header</a>
      <li><a href="#label-Invoking+HTTP+methods+asynchronously">Invoking HTTP methods asynchronously</a>
      <li><a href="#label-Shortcut+methods">Shortcut methods</a>
    </ul>
  </nav>
</div>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/httpclient.rb
    <li>lib/httpclient/auth.rb
    <li>lib/httpclient/connection.rb
    <li>lib/httpclient/cookie.rb
    <li>lib/httpclient/include_client.rb
    <li>lib/httpclient/session.rb
    <li>lib/httpclient/ssl_config.rb
    <li>lib/httpclient/timeout.rb
    <li>lib/httpclient/util.rb
    <li>lib/httpclient/version.rb
    <li>lib/httpclient/webagent-cookie.rb
    <li>lib/oauthclient.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="HTTPClient/Util.html">HTTPClient::Util</a>
  
  
  </ul>
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-c-attr_proxy">::attr_proxy</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-timeout_scheduler">::timeout_scheduler</a>
    
    <li ><a href="#method-i-body">#body</a>
    
    <li ><a href="#method-i-cookies">#cookies</a>
    
    <li ><a href="#method-i-create_boundary">#create_boundary</a>
    
    <li ><a href="#method-i-create_request">#create_request</a>
    
    <li ><a href="#method-i-debug_dev">#debug_dev</a>
    
    <li ><a href="#method-i-debug_dev-3D">#debug_dev=</a>
    
    <li ><a href="#method-i-default_redirect_uri_callback">#default_redirect_uri_callback</a>
    
    <li ><a href="#method-i-delete">#delete</a>
    
    <li ><a href="#method-i-delete_async">#delete_async</a>
    
    <li ><a href="#method-i-do_get_block">#do_get_block</a>
    
    <li ><a href="#method-i-do_get_header">#do_get_header</a>
    
    <li ><a href="#method-i-do_get_stream">#do_get_stream</a>
    
    <li ><a href="#method-i-do_request">#do_request</a>
    
    <li ><a href="#method-i-do_request_async">#do_request_async</a>
    
    <li ><a href="#method-i-dump_dummy_request_response">#dump_dummy_request_response</a>
    
    <li ><a href="#method-i-file_in_form_data-3F">#file_in_form_data?</a>
    
    <li ><a href="#method-i-follow_redirect">#follow_redirect</a>
    
    <li ><a href="#method-i-force_basic_auth-3D">#force_basic_auth=</a>
    
    <li ><a href="#method-i-get">#get</a>
    
    <li ><a href="#method-i-get_async">#get_async</a>
    
    <li ><a href="#method-i-get_content">#get_content</a>
    
    <li ><a href="#method-i-getenv">#getenv</a>
    
    <li ><a href="#method-i-hashy_argument_has_keys">#hashy_argument_has_keys</a>
    
    <li ><a href="#method-i-head">#head</a>
    
    <li ><a href="#method-i-head_async">#head_async</a>
    
    <li ><a href="#method-i-keep_webmock_compat">#keep_webmock_compat</a>
    
    <li ><a href="#method-i-load_environment">#load_environment</a>
    
    <li ><a href="#method-i-no_proxy">#no_proxy</a>
    
    <li ><a href="#method-i-no_proxy-3D">#no_proxy=</a>
    
    <li ><a href="#method-i-no_proxy-3F">#no_proxy?</a>
    
    <li ><a href="#method-i-options">#options</a>
    
    <li ><a href="#method-i-options_async">#options_async</a>
    
    <li ><a href="#method-i-override_header">#override_header</a>
    
    <li ><a href="#method-i-post">#post</a>
    
    <li ><a href="#method-i-post_async">#post_async</a>
    
    <li ><a href="#method-i-post_content">#post_content</a>
    
    <li ><a href="#method-i-propfind">#propfind</a>
    
    <li ><a href="#method-i-propfind_async">#propfind_async</a>
    
    <li ><a href="#method-i-proppatch">#proppatch</a>
    
    <li ><a href="#method-i-proppatch_async">#proppatch_async</a>
    
    <li ><a href="#method-i-protect_keep_alive_disconnected">#protect_keep_alive_disconnected</a>
    
    <li ><a href="#method-i-proxy">#proxy</a>
    
    <li ><a href="#method-i-proxy-3D">#proxy=</a>
    
    <li ><a href="#method-i-put">#put</a>
    
    <li ><a href="#method-i-put_async">#put_async</a>
    
    <li ><a href="#method-i-redirect_uri_callback-3D">#redirect_uri_callback=</a>
    
    <li ><a href="#method-i-request">#request</a>
    
    <li ><a href="#method-i-request_async">#request_async</a>
    
    <li ><a href="#method-i-request_async2">#request_async2</a>
    
    <li ><a href="#method-i-reset">#reset</a>
    
    <li ><a href="#method-i-reset_all">#reset_all</a>
    
    <li ><a href="#method-i-save_cookie_store">#save_cookie_store</a>
    
    <li ><a href="#method-i-set_auth">#set_auth</a>
    
    <li ><a href="#method-i-set_basic_auth">#set_basic_auth</a>
    
    <li ><a href="#method-i-set_cookie_store">#set_cookie_store</a>
    
    <li ><a href="#method-i-set_encoding">#set_encoding</a>
    
    <li ><a href="#method-i-set_proxy_auth">#set_proxy_auth</a>
    
    <li ><a href="#method-i-strict_redirect_uri_callback">#strict_redirect_uri_callback</a>
    
    <li ><a href="#method-i-success_content">#success_content</a>
    
    <li ><a href="#method-i-to_resource_url">#to_resource_url</a>
    
    <li ><a href="#method-i-trace">#trace</a>
    
    <li ><a href="#method-i-trace_async">#trace_async</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./lib/httpclient/cacert_p7s.html">cacert.p7s</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Encoding.html">Encoding</a>
  
    <li><a href="./HTTP.html">HTTP</a>
  
    <li><a href="./HTTP/Message.html">HTTP::Message</a>
  
    <li><a href="./HTTP/Message/Array.html">HTTP::Message::Array</a>
  
    <li><a href="./HTTP/Message/Body.html">HTTP::Message::Body</a>
  
    <li><a href="./HTTP/Message/Body/Parts.html">HTTP::Message::Body::Parts</a>
  
    <li><a href="./HTTP/Message/Headers.html">HTTP::Message::Headers</a>
  
    <li><a href="./HTTP/Status.html">HTTP::Status</a>
  
    <li><a href="./HTTPAccess2.html">HTTPAccess2</a>
  
    <li><a href="./HTTPAccess2/Client.html">HTTPAccess2::Client</a>
  
    <li><a href="./HTTPAccess2/Client/RetryableResponse.html">HTTPAccess2::Client::RetryableResponse</a>
  
    <li><a href="./HTTPAccess2/Session.html">HTTPAccess2::Session</a>
  
    <li><a href="./HTTPAccess2/Session/BadResponse.html">HTTPAccess2::Session::BadResponse</a>
  
    <li><a href="./HTTPAccess2/Session/Error.html">HTTPAccess2::Session::Error</a>
  
    <li><a href="./HTTPAccess2/Session/InvalidState.html">HTTPAccess2::Session::InvalidState</a>
  
    <li><a href="./HTTPAccess2/Session/KeepAliveDisconnected.html">HTTPAccess2::Session::KeepAliveDisconnected</a>
  
    <li><a href="./HTTPClient.html">HTTPClient</a>
  
    <li><a href="./HTTPClient/AuthBase.html">HTTPClient::AuthBase</a>
  
    <li><a href="./HTTPClient/AuthFilterBase.html">HTTPClient::AuthFilterBase</a>
  
    <li><a href="./HTTPClient/BadResponse.html">HTTPClient::BadResponse</a>
  
    <li><a href="./HTTPClient/BadResponseError.html">HTTPClient::BadResponseError</a>
  
    <li><a href="./HTTPClient/BasicAuth.html">HTTPClient::BasicAuth</a>
  
    <li><a href="./HTTPClient/ConfigurationError.html">HTTPClient::ConfigurationError</a>
  
    <li><a href="./HTTPClient/ConnectTimeoutError.html">HTTPClient::ConnectTimeoutError</a>
  
    <li><a href="./HTTPClient/Connection.html">HTTPClient::Connection</a>
  
    <li><a href="./HTTPClient/CookieManager.html">HTTPClient::CookieManager</a>
  
    <li><a href="./HTTPClient/DebugSocket.html">HTTPClient::DebugSocket</a>
  
    <li><a href="./HTTPClient/DigestAuth.html">HTTPClient::DigestAuth</a>
  
    <li><a href="./HTTPClient/IncludeClient.html">HTTPClient::IncludeClient</a>
  
    <li><a href="./HTTPClient/KeepAliveDisconnected.html">HTTPClient::KeepAliveDisconnected</a>
  
    <li><a href="./HTTPClient/LoopBackSocket.html">HTTPClient::LoopBackSocket</a>
  
    <li><a href="./HTTPClient/NegotiateAuth.html">HTTPClient::NegotiateAuth</a>
  
    <li><a href="./HTTPClient/OAuth.html">HTTPClient::OAuth</a>
  
    <li><a href="./HTTPClient/OAuth/Config.html">HTTPClient::OAuth::Config</a>
  
    <li><a href="./HTTPClient/ProxyAuth.html">HTTPClient::ProxyAuth</a>
  
    <li><a href="./HTTPClient/ProxyBasicAuth.html">HTTPClient::ProxyBasicAuth</a>
  
    <li><a href="./HTTPClient/ProxyDigestAuth.html">HTTPClient::ProxyDigestAuth</a>
  
    <li><a href="./HTTPClient/ReceiveTimeoutError.html">HTTPClient::ReceiveTimeoutError</a>
  
    <li><a href="./HTTPClient/RetryableResponse.html">HTTPClient::RetryableResponse</a>
  
    <li><a href="./HTTPClient/SSLConfig.html">HTTPClient::SSLConfig</a>
  
    <li><a href="./HTTPClient/SSLSocketWrap.html">HTTPClient::SSLSocketWrap</a>
  
    <li><a href="./HTTPClient/SSPINegotiateAuth.html">HTTPClient::SSPINegotiateAuth</a>
  
    <li><a href="./HTTPClient/SendTimeoutError.html">HTTPClient::SendTimeoutError</a>
  
    <li><a href="./HTTPClient/Session.html">HTTPClient::Session</a>
  
    <li><a href="./HTTPClient/SessionManager.html">HTTPClient::SessionManager</a>
  
    <li><a href="./HTTPClient/Site.html">HTTPClient::Site</a>
  
    <li><a href="./HTTPClient/SocketWrap.html">HTTPClient::SocketWrap</a>
  
    <li><a href="./HTTPClient/Timeout.html">HTTPClient::Timeout</a>
  
    <li><a href="./HTTPClient/TimeoutError.html">HTTPClient::TimeoutError</a>
  
    <li><a href="./HTTPClient/TimeoutScheduler.html">HTTPClient::TimeoutScheduler</a>
  
    <li><a href="./HTTPClient/TimeoutScheduler/Period.html">HTTPClient::TimeoutScheduler::Period</a>
  
    <li><a href="./HTTPClient/Util.html">HTTPClient::Util</a>
  
    <li><a href="./HTTPClient/Util/Addressable.html">HTTPClient::Util::Addressable</a>
  
    <li><a href="./HTTPClient/Util/AddressableURI.html">HTTPClient::Util::AddressableURI</a>
  
    <li><a href="./HTTPClient/WWWAuth.html">HTTPClient::WWWAuth</a>
  
    <li><a href="./HTTPClient/WebAgentSaver.html">HTTPClient::WebAgentSaver</a>
  
    <li><a href="./HexDump.html">HexDump</a>
  
    <li><a href="./JSONClient.html">JSONClient</a>
  
    <li><a href="./OAuthClient.html">OAuthClient</a>
  
    <li><a href="./String.html">String</a>
  
    <li><a href="./URI.html">URI</a>
  
    <li><a href="./URI/Generic.html">URI::Generic</a>
  
    <li><a href="./WebAgent.html">WebAgent</a>
  
    <li><a href="./WebAgent/Cookie.html">WebAgent::Cookie</a>
  
    <li><a href="./WebAgent/CookieManager.html">WebAgent::CookieManager</a>
  
    <li><a href="./WebAgent/CookieManager/Error.html">WebAgent::CookieManager::Error</a>
  
    <li><a href="./WebAgent/CookieManager/ErrorOverrideOK.html">WebAgent::CookieManager::ErrorOverrideOK</a>
  
    <li><a href="./WebAgent/CookieManager/SpecialError.html">WebAgent::CookieManager::SpecialError</a>
  
    <li><a href="./WebAgent/CookieUtils.html">WebAgent::CookieUtils</a>
  
    <li><a href="./WebAgent/SynchronizedArray.html">WebAgent::SynchronizedArray</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class HTTPClient</h1>

  <div id="description" class="description">
    
<p>The <a href="HTTPClient.html">HTTPClient</a> class provides several methods
for accessing Web resources via <a href="HTTP.html">HTTP</a>.</p>

<p><a href="HTTPClient.html">HTTPClient</a> instance is designed to be
MT-safe.  You can call a <a href="HTTPClient.html">HTTPClient</a> instance
from several threads without synchronization after setting up an instance.</p>

<pre class="ruby"><span class="ruby-identifier">clnt</span> = <span class="ruby-constant">HTTPClient</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">set_cookie_store</span>(<span class="ruby-string">&#39;/home/nahi/cookie.dat&#39;</span>)
<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">url</span><span class="ruby-operator">|</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">head</span>(<span class="ruby-identifier">u</span>).<span class="ruby-identifier">status</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-How+to+use">How to use<span><a href="#label-How+to+use">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>At first, how to create your client.  See initialize for more detail.</p>
<ol><li>
<p>Create simple client.</p>

<pre>clnt = HTTPClient.new</pre>
</li><li>
<p>Accessing resources through <a href="HTTP.html">HTTP</a> proxy.  You can
use environment variable &#39;http_proxy&#39; or &#39;HTTP_PROXY&#39;
instead.</p>

<pre>clnt = HTTPClient.new(&#39;http://myproxy:8080&#39;)</pre>
</li></ol>

<h3 id="label-How+to+retrieve+web+resources">How to retrieve web resources<span><a href="#label-How+to+retrieve+web+resources">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>See get and get_content.</p>
<ol><li>
<p>Get content of specified URL.  It returns <a
href="HTTP/Message.html">HTTP::Message</a> object and calling
&#39;body&#39; method of it returns a content <a
href="String.html">String</a>.</p>

<pre>puts clnt.get(&#39;http://dev.ctor.org/&#39;).body</pre>
</li><li>
<p>For getting content directly, use get_content.  It follows redirect
response and returns a <a href="String.html">String</a> of whole result.</p>

<pre>puts clnt.get_content(&#39;http://dev.ctor.org/&#39;)</pre>
</li><li>
<p>You can pass :follow_redirect option to follow redirect response in get.</p>

<pre class="ruby"><span class="ruby-identifier">puts</span> <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;http://dev.ctor.org/&#39;</span>, :<span class="ruby-identifier">follow_redirect</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
</pre>
</li><li>
<p>Get content as chunks of <a href="String.html">String</a>.  It yields
chunks of <a href="String.html">String</a>.</p>

<pre class="ruby"><span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get_content</span>(<span class="ruby-string">&#39;http://dev.ctor.org/&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">chunk</span>
<span class="ruby-keyword">end</span>
</pre>
</li></ol>

<h3 id="label-Invoking+other+HTTP+methods">Invoking other <a href="HTTP.html">HTTP</a> methods<span><a href="#label-Invoking+other+HTTP+methods">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>See head, get, post, put, delete, options, propfind, proppatch and trace.</p>

<p>It returns a <a href="HTTP/Message.html">HTTP::Message</a> instance as a
response.</p>
<ol><li>
<p>Do HEAD request.</p>

<pre>res = clnt.head(uri)
p res.header[&#39;Last-Modified&#39;][0]</pre>
</li><li>
<p>Do GET request with query.</p>

<pre class="ruby"><span class="ruby-identifier">query</span> = { <span class="ruby-string">&#39;keyword&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;ruby&#39;</span>, <span class="ruby-string">&#39;lang&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;en&#39;</span> }
<span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>)
<span class="ruby-identifier">p</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">status</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">contenttype</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">header</span>[<span class="ruby-string">&#39;X-Custom&#39;</span>]
<span class="ruby-identifier">puts</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span>
</pre>

<p>You can also use keyword argument style.</p>

<pre class="ruby"><span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>, :<span class="ruby-identifier">query</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">keyword</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;ruby&#39;</span>, :<span class="ruby-identifier">lang</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;en&#39;</span> })
</pre>
</li></ol>

<h3 id="label-How+to+POST">How to POST<span><a href="#label-How+to+POST">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>See post.</p>
<ol><li>
<p>Do POST a form data.</p>

<pre class="ruby"><span class="ruby-identifier">body</span> = { <span class="ruby-string">&#39;keyword&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;ruby&#39;</span>, <span class="ruby-string">&#39;lang&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;en&#39;</span> }
<span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">body</span>)
</pre>

<p>Keyword argument style.</p>

<pre class="ruby"><span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, :<span class="ruby-identifier">body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">...</span>)
</pre>
</li><li>
<p>Do multipart file upload with POST.  No need to set extra header by
yourself from httpclient/2.1.4.</p>

<pre class="ruby"><span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-string">&#39;/tmp/post_data&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">body</span> = { <span class="ruby-string">&#39;upload&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;user&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;nahi&#39;</span> }
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p>Do multipart with custom body.</p>

<pre class="ruby"><span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-string">&#39;/tmp/post_data&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">body</span> = [{ <span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;application/atom+xml; charset=UTF-8&#39;</span>,
            :<span class="ruby-identifier">content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;&lt;entry&gt;...&lt;/entry&gt;&#39;</span> },
          { <span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;video/mp4&#39;</span>,
            <span class="ruby-string">&#39;Content-Transfer-Encoding&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;binary&#39;</span>,
            :<span class="ruby-identifier">content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span> }]
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span>
</pre>
</li></ol>

<h3 id="label-Accessing+via+SSL">Accessing via SSL<span><a href="#label-Accessing+via+SSL">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Ruby needs to be compiled with OpenSSL.</p>
<ol><li>
<p>Get content of specified URL via SSL. Just pass an URL which starts with
&#39;https://&#39;.</p>

<pre>https_url = &#39;https://www.rsa.com&#39;
clnt.get(https_url)</pre>
</li><li>
<p>Getting peer certificate from response.</p>

<pre class="ruby"><span class="ruby-identifier">res</span> = <span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">https_url</span>)
<span class="ruby-identifier">p</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">peer_cert</span> <span class="ruby-comment">#=&gt; returns OpenSSL::X509::Certificate</span>
</pre>
</li><li>
<p>Configuring OpenSSL options.  See <a
href="HTTPClient/SSLConfig.html">HTTPClient::SSLConfig</a> for more
details.</p>

<pre>user_cert_file = &#39;cert.pem&#39;
user_key_file = &#39;privkey.pem&#39;
clnt.ssl_config.set_client_cert_file(user_cert_file, user_key_file)
clnt.get(https_url)</pre>
</li></ol>

<h3 id="label-Handling+Cookies">Handling Cookies<span><a href="#label-Handling+Cookies">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ol><li>
<p>Using volatile Cookies.  Nothing to do.  <a
href="HTTPClient.html">HTTPClient</a> handles Cookies.</p>

<pre>clnt = HTTPClient.new
res = clnt.get(url1) # receives Cookies.
res = clnt.get(url2) # sends Cookies if needed.
p res.cookies</pre>
</li><li>
<p>Saving non volatile Cookies to a specified file.  Need to set a file at
first and invoke save method at last.</p>

<pre>clnt = HTTPClient.new
clnt.set_cookie_store(&#39;/home/nahi/cookie.dat&#39;)
clnt.get(url)
...
clnt.save_cookie_store</pre>
</li><li>
<p>Disabling Cookies.</p>

<pre>clnt = HTTPClient.new
clnt.cookie_manager = nil</pre>
</li></ol>

<h3 id="label-Configuring+authentication+credentials">Configuring authentication credentials<span><a href="#label-Configuring+authentication+credentials">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ol><li>
<p>Authentication with Web server.  Supports <a
href="HTTPClient/BasicAuth.html">BasicAuth</a>, <a
href="HTTPClient/DigestAuth.html">DigestAuth</a>, and Negotiate/NTLM
(requires ruby/ntlm module).</p>

<pre>clnt = HTTPClient.new
domain = &#39;http://dev.ctor.org/http-access2/&#39;
user = &#39;user&#39;
password = &#39;user&#39;
clnt.set_auth(domain, user, password)
p clnt.get(&#39;http://dev.ctor.org/http-access2/login&#39;).status</pre>
</li><li>
<p>Authentication with Proxy server.  Supports <a
href="HTTPClient/BasicAuth.html">BasicAuth</a> and NTLM (requires
win32/sspi)</p>

<pre>clnt = HTTPClient.new(proxy)
user = &#39;proxy&#39;
password = &#39;proxy&#39;
clnt.set_proxy_auth(user, password)
p clnt.get(url)</pre>
</li></ol>

<h3 id="label-Invoking+HTTP+methods+with+custom+header">Invoking <a href="HTTP.html">HTTP</a> methods with custom header<span><a href="#label-Invoking+HTTP+methods+with+custom+header">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Pass a Hash or an Array for header argument.</p>

<pre class="ruby"><span class="ruby-identifier">header</span> = { <span class="ruby-string">&#39;Accept&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/html&#39;</span> }
<span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">header</span>)

<span class="ruby-identifier">header</span> = [[<span class="ruby-string">&#39;Accept&#39;</span>, <span class="ruby-string">&#39;image/jpeg&#39;</span>], [<span class="ruby-string">&#39;Accept&#39;</span>, <span class="ruby-string">&#39;image/png&#39;</span>]]
<span class="ruby-identifier">clnt</span>.<span class="ruby-identifier">get_content</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">header</span>)
</pre>

<h3 id="label-Invoking+HTTP+methods+asynchronously">Invoking <a href="HTTP.html">HTTP</a> methods asynchronously<span><a href="#label-Invoking+HTTP+methods+asynchronously">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>See <a href="HTTPClient.html#method-i-head_async">#head_async</a>, <a
href="HTTPClient.html#method-i-get_async">#get_async</a>, <a
href="HTTPClient.html#method-i-post_async">#post_async</a>, <a
href="HTTPClient.html#method-i-put_async">#put_async</a>, <a
href="HTTPClient.html#method-i-delete_async">#delete_async</a>, <a
href="HTTPClient.html#method-i-options_async">#options_async</a>, <a
href="HTTPClient.html#method-i-propfind_async">#propfind_async</a>, <a
href="HTTPClient.html#method-i-proppatch_async">#proppatch_async</a>, and
trace_async. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
returning value.</p>

<pre>connection = clnt.post_async(url, body)
print &#39;posting.&#39;
while true
  break if connection.finished?
  print &#39;.&#39;
  sleep 1
end
puts &#39;.&#39;
res = connection.pop
p res.status
p res.body.read # res.body is an IO for the res of async method.</pre>

<h3 id="label-Shortcut+methods">Shortcut methods<span><a href="#label-Shortcut+methods">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>You can invoke <a
href="HTTPClient.html#method-i-get_content">#get_content</a>, get, etc.
without creating <a href="HTTPClient.html">HTTPClient</a> instance.</p>

<pre>ruby -rhttpclient -e &#39;puts HTTPClient.get_content(ARGV.shift)&#39; http://dev.ctor.org/
ruby -rhttpclient -e &#39;p HTTPClient.head(ARGV.shift).header[&quot;last-modified&quot;]&#39; http://dev.ctor.org/</pre>

<p><a href="HTTPClient.html">HTTPClient</a> - <a href="HTTP.html">HTTP</a>
client library. Copyright (C) 2000-2009  NAKAMURA, Hiroshi 
&lt;nahi@ruby-lang.org&gt;.</p>

<p>This program is copyrighted free software by NAKAMURA, Hiroshi.  You can
redistribute it and/or modify it under the same terms of Ruby&#39;s
license; either the dual license version in 2003, or any later version.</p>

<p><a href="HTTPClient.html">HTTPClient</a> - <a href="HTTP.html">HTTP</a>
client library. Copyright (C) 2000-2009  NAKAMURA, Hiroshi 
&lt;nahi@ruby-lang.org&gt;.</p>

<p>This program is copyrighted free software by NAKAMURA, Hiroshi.  You can
redistribute it and/or modify it under the same terms of Ruby&#39;s
license; either the dual license version in 2003, or any later version.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="CookieManager">CookieManager
        
        <dd class="description">
        
      
        <dt id="DEFAULT_AGENT_NAME">DEFAULT_AGENT_NAME
        
        <dd class="description"><p>Default User-Agent header</p>
        
      
        <dt id="GSSAPIEnabled">GSSAPIEnabled
        
        <dd class="description">
        
      
        <dt id="LIB_NAME">LIB_NAME
        
        <dd class="description">
        
      
        <dt id="NO_PROXY_HOSTS">NO_PROXY_HOSTS
        
        <dd class="description">
        
      
        <dt id="NTLMEnabled">NTLMEnabled
        
        <dd class="description">
        
      
        <dt id="PROPFIND_DEFAULT_EXTHEADER">PROPFIND_DEFAULT_EXTHEADER
        
        <dd class="description"><p>Default header for PROPFIND request.</p>
        
      
        <dt id="RUBY_VERSION_STRING">RUBY_VERSION_STRING
        
        <dd class="description">
        
      
        <dt id="SSLEnabled">SSLEnabled
        
        <dd class="description">
        
      
        <dt id="SSPIEnabled">SSPIEnabled
        
        <dd class="description">
        
      
        <dt id="VERSION">VERSION
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-base_url" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">base_url</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Base url of resources.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-cookie_manager" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cookie_manager</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <dl class="rdoc-list note-list"><dt><a href="HTTPClient/CookieManager.html">HTTPClient::CookieManager</a>
<dd>
<p>Cookies configurator.</p>
</dd></dl>
        
        </div>
      </div>
      
      <div id="attribute-i-default_header" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">default_header</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Defalut request header.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-follow_redirect_count" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">follow_redirect_count</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>How many times <a
href="HTTPClient.html#method-i-get_content">#get_content</a> and <a
href="HTTPClient.html#method-i-post_content">#post_content</a> follows <a
href="HTTP.html">HTTP</a> redirect. 10 by default.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-proxy_auth" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">proxy_auth</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <dl class="rdoc-list note-list"><dt><a href="HTTPClient/ProxyAuth.html">HTTPClient::ProxyAuth</a>
<dd>
<p>Proxy authentication handler.</p>
</dd></dl>
        
        </div>
      </div>
      
      <div id="attribute-i-request_filter" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">request_filter</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>An array of request filter which can trap <a href="HTTP.html">HTTP</a>
request/response. See <a
href="HTTPClient/WWWAuth.html">HTTPClient::WWWAuth</a> to see how to use
it.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-ssl_config" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">ssl_config</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <dl class="rdoc-list note-list"><dt><a href="HTTPClient/SSLConfig.html">HTTPClient::SSLConfig</a>
<dd>
<p>SSL configurator.</p>
</dd></dl>
        
        </div>
      </div>
      
      <div id="attribute-i-test_loopback_response" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">test_loopback_response</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>An array of response <a href="HTTP.html">HTTP</a> message body <a
href="String.html">String</a> which is used for loop-back test.  See test/*
to see how to use it.  If you want to do loop-back test of <a
href="HTTP.html">HTTP</a> header, use test_loopback_http_response instead.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-www_auth" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">www_auth</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <dl class="rdoc-list note-list"><dt><a href="HTTPClient/WWWAuth.html">HTTPClient::WWWAuth</a>
<dd>
<p>WWW authentication handler.</p>
</dd></dl>
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a <a href="HTTPClient.html">HTTPClient</a> instance which manages
sessions, cookies, etc.</p>

<p><a href="HTTPClient.html#method-c-new">::new</a> takes optional arguments
as a Hash.</p>

<pre>* :proxy - proxy url string
* :agent_name - User-Agent String
* :from - from header String
* :base_url - base URL of resources
* :default_header - header Hash all HTTP requests should have
* :force_basic_auth - flag for sending Authorization header w/o gettin 401 first</pre>

<p>User-Agent and From are embedded in <a href="HTTP.html">HTTP</a> request
Header if given. From header is not set without setting it explicitly.</p>

<pre>proxy = &#39;http://myproxy:8080&#39;
agent_name = &#39;MyAgent/0.1&#39;
from = &#39;from@example.com&#39;
HTTPClient.new(proxy, agent_name, from)</pre>

<p>After you set :base_url, all resources you pass to get, post and other
methods are recognized to be prefixed with base_url. Say <a
href="HTTPClient.html#attribute-i-base_url">#base_url</a> is &#39;<a
href="https://api.example.com/v1">api.example.com/v1</a>,
get(&#39;/users&#39;) is the same as get(&#39;<a
href="https://api.example.com/v1/users">api.example.com/v1/users</a>&#39;)
internally. You can also pass full URL from &#39;http://&#39; even after
setting base_url.</p>

<p>:default_header is for providing default headers Hash that all <a
href="HTTP.html">HTTP</a> requests should have, such as custom
&#39;Authorization&#39; header in API. You can override :default_header
with :header Hash parameter in <a href="HTTP.html">HTTP</a> request
methods.</p>

<p>:force_basic_auth turns on/off the <a
href="HTTPClient/BasicAuth.html">BasicAuth</a> force flag. Generally <a
href="HTTP.html">HTTP</a> client must send Authorization header after it
gets 401 error from server from security reason. But in some situation
(e.g. API client) you might want to send Authorization from the beginning.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 399</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">proxy</span>, <span class="ruby-identifier">agent_name</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">base_url</span>, <span class="ruby-identifier">default_header</span>, <span class="ruby-identifier">force_basic_auth</span> =
    <span class="ruby-identifier">keyword_argument</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:proxy</span>, <span class="ruby-value">:agent_name</span>, <span class="ruby-value">:from</span>, <span class="ruby-value">:base_url</span>, <span class="ruby-value">:default_header</span>, <span class="ruby-value">:force_basic_auth</span>)
  <span class="ruby-ivar">@proxy</span> = <span class="ruby-keyword">nil</span>        <span class="ruby-comment"># assigned later.</span>
  <span class="ruby-ivar">@no_proxy</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@no_proxy_regexps</span> = []
  <span class="ruby-ivar">@base_url</span> = <span class="ruby-identifier">base_url</span>
  <span class="ruby-ivar">@default_header</span> = <span class="ruby-identifier">default_header</span> <span class="ruby-operator">||</span> {}
  <span class="ruby-ivar">@www_auth</span> = <span class="ruby-constant">WWWAuth</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@proxy_auth</span> = <span class="ruby-constant">ProxyAuth</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@www_auth</span>.<span class="ruby-identifier">basic_auth</span>.<span class="ruby-identifier">force_auth</span> = <span class="ruby-ivar">@proxy_auth</span>.<span class="ruby-identifier">basic_auth</span>.<span class="ruby-identifier">force_auth</span> = <span class="ruby-identifier">force_basic_auth</span>
  <span class="ruby-ivar">@request_filter</span> = [<span class="ruby-ivar">@proxy_auth</span>, <span class="ruby-ivar">@www_auth</span>]
  <span class="ruby-ivar">@debug_dev</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@redirect_uri_callback</span> = <span class="ruby-identifier">method</span>(<span class="ruby-value">:default_redirect_uri_callback</span>)
  <span class="ruby-ivar">@test_loopback_response</span> = []
  <span class="ruby-ivar">@session_manager</span> = <span class="ruby-constant">SessionManager</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">agent_name</span> = <span class="ruby-identifier">agent_name</span> <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_AGENT_NAME</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">from</span> = <span class="ruby-identifier">from</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">ssl_config</span> = <span class="ruby-ivar">@ssl_config</span> = <span class="ruby-constant">SSLConfig</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@cookie_manager</span> = <span class="ruby-constant">CookieManager</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@follow_redirect_count</span> = <span class="ruby-value">10</span>
  <span class="ruby-identifier">load_environment</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">proxy</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">proxy</span>
  <span class="ruby-identifier">keep_webmock_compat</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-c-timeout_scheduler" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timeout_scheduler</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CAUTION: caller must aware of race condition.</p>
          
          

          
          <div class="method-source-code" id="timeout_scheduler-source">
            <pre><span class="ruby-comment"># File lib/httpclient/timeout.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timeout_scheduler</span>
  <span class="ruby-ivar">@timeout_scheduler</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TimeoutScheduler</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timeout_scheduler-source -->
          
        </div>

        

        
      </div><!-- timeout_scheduler-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="private-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Class Methods</h3>

    
      <div id="method-c-attr_proxy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attr_proxy</span><span
            class="method-args">(symbol, assignable = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="attr_proxy-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 294</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attr_proxy</span>(<span class="ruby-identifier">symbol</span>, <span class="ruby-identifier">assignable</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">symbol</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">name</span>) {
    <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">__send__</span>(<span class="ruby-identifier">name</span>)
  }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">assignable</span>
    <span class="ruby-identifier">aname</span> = <span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;=&#39;</span>
    <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">aname</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">rhs</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">reset_all</span>
      <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">__send__</span>(<span class="ruby-identifier">aname</span>, <span class="ruby-identifier">rhs</span>)
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- attr_proxy-source -->
          
        </div>

        

        
      </div><!-- attr_proxy-method -->

    
    </section><!-- private-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-body" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">body</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="body-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">body</span>
  <span class="ruby-keyword">def</span> (<span class="ruby-identifier">o</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">content</span>).<span class="ruby-identifier">content</span>
    <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">o</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- body-source -->
          
        </div>

        

        
      </div><!-- body-method -->

    
      <div id="method-i-cookies" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cookies</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns stored cookies.</p>
          
          

          
          <div class="method-source-code" id="cookies-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 584</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cookies</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cookie_manager</span>
    <span class="ruby-ivar">@cookie_manager</span>.<span class="ruby-identifier">cookies</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cookies-source -->
          
        </div>

        

        
      </div><!-- cookies-method -->

    
      <div id="method-i-debug_dev" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">debug_dev</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns debug device if exists.  See <a
href="HTTPClient.html#method-i-debug_dev">#debug_dev</a>=.</p>
          
          

          
          <div class="method-source-code" id="debug_dev-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 441</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">debug_dev</span>
  <span class="ruby-ivar">@debug_dev</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- debug_dev-source -->
          
        </div>

        

        
      </div><!-- debug_dev-method -->

    
      <div id="method-i-debug_dev-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">debug_dev=</span><span
            class="method-args">(dev)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets debug device.  Once debug device is set, all <a
href="HTTP.html">HTTP</a> requests and responses are dumped to given
device.  dev must respond to &lt;&lt; for dump.</p>

<p>Calling this method resets all existing sessions.</p>
          
          

          
          <div class="method-source-code" id="debug_dev-3D-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 449</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">debug_dev=</span>(<span class="ruby-identifier">dev</span>)
  <span class="ruby-ivar">@debug_dev</span> = <span class="ruby-identifier">dev</span>
  <span class="ruby-identifier">reset_all</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">debug_dev</span> = <span class="ruby-identifier">dev</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- debug_dev-3D-source -->
          
        </div>

        

        
      </div><!-- debug_dev-3D-method -->

    
      <div id="method-i-default_redirect_uri_callback" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default_redirect_uri_callback</span><span
            class="method-args">(uri, res)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A default method for redirect uri callback.  This method is used by <a
href="HTTPClient.html">HTTPClient</a> instance by default. This callback
allows relative redirect such as</p>

<pre>Location: ../foo/</pre>

<p>in <a href="HTTP.html">HTTP</a> header.</p>
          
          

          
          <div class="method-source-code" id="default_redirect_uri_callback-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 692</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">default_redirect_uri_callback</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">res</span>)
  <span class="ruby-identifier">newuri</span> = <span class="ruby-identifier">urify</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">header</span>[<span class="ruby-string">&#39;location&#39;</span>][<span class="ruby-value">0</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">http?</span>(<span class="ruby-identifier">newuri</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">https?</span>(<span class="ruby-identifier">newuri</span>)
    <span class="ruby-identifier">newuri</span> = <span class="ruby-identifier">uri</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">newuri</span>
    <span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;could be a relative URI in location header which is not recommended&quot;</span>)
    <span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;&#39;The field value consists of a single absolute URI&#39; in HTTP spec&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">https?</span>(<span class="ruby-identifier">uri</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">https?</span>(<span class="ruby-identifier">newuri</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadResponseError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;redirecting to non-https resource&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;redirect to: #{newuri}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$DEBUG</span>
  <span class="ruby-identifier">newuri</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- default_redirect_uri_callback-source -->
          
        </div>

        

        
      </div><!-- default_redirect_uri_callback-method -->

    
      <div id="method-i-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends DELETE request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 739</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:delete</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:query</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete-source -->
          
        </div>

        

        
      </div><!-- delete-method -->

    
      <div id="method-i-delete_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends DELETE request in async style.  See <a
href="HTTPClient.html#method-i-request_async2">#request_async2</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="delete_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 862</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:delete</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:query</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_async-source -->
          
        </div>

        

        
      </div><!-- delete_async-method -->

    
      <div id="method-i-force_basic_auth-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">force_basic_auth=</span><span
            class="method-args">(force_basic_auth)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Turn on/off the <a href="HTTPClient/BasicAuth.html">BasicAuth</a> force
flag. Generally <a href="HTTP.html">HTTP</a> client must send Authorization
header after it gets 401 error from server from security reason. But in
some situation (e.g. API client) you might want to send Authorization from
the beginning.</p>
          
          

          
          <div class="method-source-code" id="force_basic_auth-3D-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 562</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">force_basic_auth=</span>(<span class="ruby-identifier">force_basic_auth</span>)
  <span class="ruby-ivar">@www_auth</span>.<span class="ruby-identifier">basic_auth</span>.<span class="ruby-identifier">force_auth</span> = <span class="ruby-ivar">@proxy_auth</span>.<span class="ruby-identifier">basic_auth</span>.<span class="ruby-identifier">force_auth</span> = <span class="ruby-identifier">force_basic_auth</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- force_basic_auth-3D-source -->
          
        </div>

        

        
      </div><!-- force_basic_auth-3D-method -->

    
      <div id="method-i-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends GET request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 712</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:follow_redirect</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get-source -->
          
        </div>

        

        
      </div><!-- get-method -->

    
      <div id="method-i-get_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends GET request in async style.  See <a
href="HTTPClient.html#method-i-request_async">#request_async</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="get_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 834</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_async-source -->
          
        </div>

        

        
      </div><!-- get_async-method -->

    
      <div id="method-i-get_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_content</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieves a web resource.</p>
<dl class="rdoc-list note-list"><dt>uri
<dd>
<p>a <a href="String.html">String</a> or an <a href="URI.html">URI</a> object
which represents an URL of web resource.</p>
</dd><dt>query
<dd>
<p>a Hash or an Array of query part of URL. e.g. { a =&gt; b } =&gt;
&#39;<a href="http://host/part?a=b">host/part?a=b</a>&#39;. Give an array
to pass multiple value like</p>
<dl class="rdoc-list label-list"><dt>[a, b], [a, c]
<dd>
<h1 id="method-i-get_content-label-%3E+%27http%3A%2F%2Fhost%2Fpart%3Fa%3Db%26a%3Dc%27.">&gt; &#39;<a href="http://host/part?a=b&a=c">host/part?a=b&a=c</a>&#39;.<span><a href="#method-i-get_content-label-%3E+%27http%3A%2F%2Fhost%2Fpart%3Fa%3Db%26a%3Dc%27.">&para;</a> <a href="#documentation">&uarr;</a></span></h1>
</dd></dl>
</dd><dt>header
<dd>
<p>a Hash or an Array of extra headers.  e.g. { &#39;Accept&#39; =&gt;
&#39;text/html&#39; } or [[&#39;Accept&#39;, &#39;image/jpeg&#39;],
[&#39;Accept&#39;, &#39;image/png&#39;]].</p>
</dd><dt>&amp;block
<dd>
<p>Give a block to get chunked message-body of response like <a
href="HTTPClient.html#method-i-get_content">#get_content</a>(uri) {
|chunked_body|  }. Size of each chunk may not be the same.</p>
</dd></dl>

<p><a href="HTTPClient.html#method-i-get_content">#get_content</a> follows <a
href="HTTP.html">HTTP</a> redirect status (see <a
href="HTTP/Status.html#method-c-redirect-3F">HTTP::Status.redirect?</a>)
internally and try to retrieve content from redirected URL.  See
redirect_uri_callback= how <a href="HTTP.html">HTTP</a> redirection is
handled.</p>

<p>If you need to get full <a href="HTTP.html">HTTP</a> response including <a
href="HTTP.html">HTTP</a> status and headers, use get method.  get returns
<a href="HTTP/Message.html">HTTP::Message</a> as a response and you need to
follow <a href="HTTP.html">HTTP</a> redirect by yourself if you need.</p>
          
          

          
          <div class="method-source-code" id="get_content-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 623</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_content</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">query</span>, <span class="ruby-identifier">header</span> = <span class="ruby-identifier">keyword_argument</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-identifier">success_content</span>(<span class="ruby-identifier">follow_redirect</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">header</span> <span class="ruby-operator">||</span> {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_content-source -->
          
        </div>

        

        
      </div><!-- get_content-method -->

    
      <div id="method-i-head" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">head</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends HEAD request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="head-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 707</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">head</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:head</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:follow_redirect</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- head-source -->
          
        </div>

        

        
      </div><!-- head-method -->

    
      <div id="method-i-head_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">head_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends HEAD request in async style.  See <a
href="HTTPClient.html#method-i-request_async">#request_async</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="head_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 828</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">head_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:head</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- head_async-source -->
          
        </div>

        

        
      </div><!-- head_async-method -->

    
      <div id="method-i-keep_webmock_compat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">keep_webmock_compat</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>webmock 1.6.2 depends on <a
href="HTTP/Message.html#method-i-body">HTTP::Message#body</a>.content to
work. let&#39;s keep it work iif webmock is loaded for a while.</p>
          
          

          
          <div class="method-source-code" id="keep_webmock_compat-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 427</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">keep_webmock_compat</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:do_get_block_with_webmock</span>)
    <span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">module_eval</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">body</span>
        <span class="ruby-keyword">def</span> (<span class="ruby-identifier">o</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">content</span>).<span class="ruby-identifier">content</span>
          <span class="ruby-keyword">self</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">o</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- keep_webmock_compat-source -->
          
        </div>

        

        
      </div><!-- keep_webmock_compat-method -->

    
      <div id="method-i-no_proxy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">no_proxy</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns NO_PROXY setting <a href="String.html">String</a> if given.</p>
          
          

          
          <div class="method-source-code" id="no_proxy-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 491</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">no_proxy</span>
  <span class="ruby-ivar">@no_proxy</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- no_proxy-source -->
          
        </div>

        

        
      </div><!-- no_proxy-method -->

    
      <div id="method-i-no_proxy-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">no_proxy=</span><span
            class="method-args">(no_proxy)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets NO_PROXY setting <a href="String.html">String</a>.  <a
href="HTTPClient.html#method-i-no_proxy">#no_proxy</a> must be a comma
separated <a href="String.html">String</a>. Each entry must be
&#39;host&#39; or &#39;host:port&#39; such as; <a
href="HTTPClient.html#method-i-no_proxy">#no_proxy</a> =
&#39;example.com,example.co.jp:443&#39;</p>

<p>&#39;localhost&#39; is treated as a <a
href="HTTPClient.html#method-i-no_proxy">#no_proxy</a> site regardless of
explicitly listed. <a href="HTTPClient.html">HTTPClient</a> checks given <a
href="URI.html">URI</a> objects before accessing it. &#39;host&#39; is tail
string match.  No IP-addr conversion.</p>

<p>You can use environment variable &#39;no_proxy&#39; or &#39;NO_PROXY&#39;
for it.</p>

<p>Calling this method resets all existing sessions.</p>
          
          

          
          <div class="method-source-code" id="no_proxy-3D-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 506</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">no_proxy=</span>(<span class="ruby-identifier">no_proxy</span>)
  <span class="ruby-ivar">@no_proxy</span> = <span class="ruby-identifier">no_proxy</span>
  <span class="ruby-ivar">@no_proxy_regexps</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@no_proxy</span>
    <span class="ruby-ivar">@no_proxy</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/([^\s:,]+)(?::(\d+))?/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">host</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">.</span>
        <span class="ruby-identifier">regexp</span> = <span class="ruby-node">/#{Regexp.quote(host)}\z/</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">regexp</span> = <span class="ruby-node">/(\A|\.)#{Regexp.quote(host)}\z/</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@no_proxy_regexps</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">regexp</span>, <span class="ruby-identifier">port</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">reset_all</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- no_proxy-3D-source -->
          
        </div>

        

        
      </div><!-- no_proxy-3D-method -->

    
      <div id="method-i-options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">options</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends OPTIONS request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="options-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 744</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">options</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:options</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">new_args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- options-source -->
          
        </div>

        

        
      </div><!-- options-method -->

    
      <div id="method-i-options_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">options_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends OPTIONS request in async style.  See <a
href="HTTPClient.html#method-i-request_async2">#request_async2</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="options_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 868</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">options_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:options</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- options_async-source -->
          
        </div>

        

        
      </div><!-- options_async-method -->

    
      <div id="method-i-post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends POST request to the specified URL.  See request for arguments. You
should not depend on :follow_redirect =&gt; true for POST method.  It sends
the same POST method to the new location which is prohibited in <a
href="HTTP.html">HTTP</a> spec.</p>
          
          

          
          <div class="method-source-code" id="post-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 719</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hashy_argument_has_keys</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>)
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:follow_redirect</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">new_args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- post-source -->
          
        </div>

        

        
      </div><!-- post-method -->

    
      <div id="method-i-post_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends POST request in async style.  See <a
href="HTTPClient.html#method-i-request_async">#request_async</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="post_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 840</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hashy_argument_has_keys</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>)
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:post</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">new_args</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- post_async-source -->
          
        </div>

        

        
      </div><!-- post_async-method -->

    
      <div id="method-i-post_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post_content</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Posts a content.</p>
<dl class="rdoc-list note-list"><dt>uri
<dd>
<p>a <a href="String.html">String</a> or an <a href="URI.html">URI</a> object
which represents an URL of web resource.</p>
</dd><dt>body
<dd>
<p>a Hash or an Array of body part. e.g.</p>

<pre class="ruby">{ <span class="ruby-string">&quot;a&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;b&quot;</span> } =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;a=b&#39;</span>
</pre>

<p>Give an array to pass multiple value like</p>

<pre class="ruby">[[<span class="ruby-string">&quot;a&quot;</span>, <span class="ruby-string">&quot;b&quot;</span>], [<span class="ruby-string">&quot;a&quot;</span>, <span class="ruby-string">&quot;c&quot;</span>]] =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;a=b&amp;a=c&#39;</span>
</pre>

<p>When you pass a File as a value, it will be posted as a
multipart/form-data.  e.g.</p>

<pre class="ruby">{ <span class="ruby-string">&#39;upload&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span> }
</pre>

<p>You can also send custom multipart by passing an array of hashes. Each part
must have a :content attribute which can be a file, all other keys will
become headers.</p>

<pre class="ruby">[{ <span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>, :<span class="ruby-identifier">content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;some text&quot;</span> },
 { <span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;video/mp4&#39;</span>, :<span class="ruby-identifier">content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;video.mp4&#39;</span>) }]
=<span class="ruby-operator">&gt;</span> <span class="ruby-operator">&lt;</span><span class="ruby-constant">Two</span> <span class="ruby-identifier">parts</span> <span class="ruby-identifier">with</span> <span class="ruby-identifier">custom</span> <span class="ruby-constant">Content</span><span class="ruby-operator">-</span><span class="ruby-constant">Type</span> <span class="ruby-identifier">header</span><span class="ruby-operator">&gt;</span>
</pre>
</dd><dt>header
<dd>
<p>a Hash or an Array of extra headers. e.g.</p>

<pre class="ruby">{ <span class="ruby-string">&#39;Accept&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/html&#39;</span> }
</pre>

<p>or</p>

<pre>[[&#39;Accept&#39;, &#39;image/jpeg&#39;], [&#39;Accept&#39;, &#39;image/png&#39;]].</pre>
</dd><dt>&amp;block
<dd>
<p>Give a block to get chunked message-body of response like</p>

<pre class="ruby"><span class="ruby-identifier">post_content</span>(<span class="ruby-identifier">uri</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">chunked_body</span><span class="ruby-operator">|</span> <span class="ruby-operator">...</span> }.
</pre>

<p>Size of each chunk may not be the same.</p>
</dd></dl>

<p><a href="HTTPClient.html#method-i-post_content">#post_content</a> follows
<a href="HTTP.html">HTTP</a> redirect status (see <a
href="HTTP/Status.html#method-c-redirect-3F">HTTP::Status.redirect?</a>)
internally and try to post the content to redirected URL.  See
redirect_uri_callback= how <a href="HTTP.html">HTTP</a> redirection is
handled. Bear in mind that you should not depend on <a
href="HTTPClient.html#method-i-post_content">#post_content</a> because it
sends the same POST method to the new location which is prohibited in <a
href="HTTP.html">HTTP</a> spec.</p>

<p>If you need to get full <a href="HTTP.html">HTTP</a> response including <a
href="HTTP.html">HTTP</a> status and headers, use post method.</p>
          
          

          
          <div class="method-source-code" id="post_content-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 660</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_content</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hashy_argument_has_keys</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>)
    <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span> = <span class="ruby-identifier">keyword_argument</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">query</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span> = <span class="ruby-identifier">keyword_argument</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">success_content</span>(<span class="ruby-identifier">follow_redirect</span>(<span class="ruby-value">:post</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span> <span class="ruby-operator">||</span> {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- post_content-source -->
          
        </div>

        

        
      </div><!-- post_content-method -->

    
      <div id="method-i-propfind" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">propfind</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends PROPFIND request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="propfind-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 750</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">propfind</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:propfind</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:header</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- propfind-source -->
          
        </div>

        

        
      </div><!-- propfind-method -->

    
      <div id="method-i-propfind_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">propfind_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends PROPFIND request in async style.  See <a
href="HTTPClient.html#method-i-request_async2">#request_async2</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="propfind_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 874</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">propfind_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:propfind</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- propfind_async-source -->
          
        </div>

        

        
      </div><!-- propfind_async-method -->

    
      <div id="method-i-proppatch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">proppatch</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends PROPPATCH request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="proppatch-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 755</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proppatch</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:proppatch</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- proppatch-source -->
          
        </div>

        

        
      </div><!-- proppatch-method -->

    
      <div id="method-i-proppatch_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">proppatch_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends PROPPATCH request in async style.  See <a
href="HTTPClient.html#method-i-request_async2">#request_async2</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="proppatch_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 880</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proppatch_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:proppatch</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- proppatch_async-source -->
          
        </div>

        

        
      </div><!-- proppatch_async-method -->

    
      <div id="method-i-proxy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">proxy</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns <a href="URI.html">URI</a> object of <a href="HTTP.html">HTTP</a>
proxy if exists.</p>
          
          

          
          <div class="method-source-code" id="proxy-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 456</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proxy</span>
  <span class="ruby-ivar">@proxy</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- proxy-source -->
          
        </div>

        

        
      </div><!-- proxy-method -->

    
      <div id="method-i-proxy-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">proxy=</span><span
            class="method-args">(proxy)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets <a href="HTTP.html">HTTP</a> proxy used for <a
href="HTTP.html">HTTP</a> connection.  Given proxy can be an <a
href="URI.html">URI</a>, a <a href="String.html">String</a> or nil.  You
can set user/password for proxy authentication like <a
href="HTTPClient.html#method-i-proxy">#proxy</a> = &#39;<a
href="http://user:passwd@myproxy:8080">user:passwd@myproxy:8080</a>&#39;</p>

<p>You can use environment variable &#39;http_proxy&#39; or
&#39;HTTP_PROXY&#39; for it. You need to use &#39;cgi_http_proxy&#39; or
&#39;CGI_HTTP_PROXY&#39; instead if you run <a
href="HTTPClient.html">HTTPClient</a> from CGI environment from security
reason. (HTTPClient checks &#39;REQUEST_METHOD&#39; environment variable
whether it&#39;s CGI or not)</p>

<p>Calling this method resets all existing sessions.</p>
          
          

          
          <div class="method-source-code" id="proxy-3D-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 470</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proxy=</span>(<span class="ruby-identifier">proxy</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@proxy</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@proxy_auth</span>.<span class="ruby-identifier">reset_challenge</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@proxy</span> = <span class="ruby-identifier">urify</span>(<span class="ruby-identifier">proxy</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">scheme</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">or</span> <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;http&#39;</span> <span class="ruby-keyword">or</span>
        <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">or</span> <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;unsupported proxy #{proxy}&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@proxy_auth</span>.<span class="ruby-identifier">reset_challenge</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">password</span>
      <span class="ruby-ivar">@proxy_auth</span>.<span class="ruby-identifier">set_auth</span>(<span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">user</span>, <span class="ruby-ivar">@proxy</span>.<span class="ruby-identifier">password</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">reset_all</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">proxy</span> = <span class="ruby-ivar">@proxy</span>
  <span class="ruby-ivar">@proxy</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- proxy-3D-source -->
          
        </div>

        

        
      </div><!-- proxy-3D-method -->

    
      <div id="method-i-put" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">put</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends PUT request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="put-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 729</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">put</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hashy_argument_has_keys</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>)
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:put</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">new_args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- put-source -->
          
        </div>

        

        
      </div><!-- put-method -->

    
      <div id="method-i-put_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">put_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends PUT request in async style.  See <a
href="HTTPClient.html#method-i-request_async2">#request_async2</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="put_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 851</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">put_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hashy_argument_has_keys</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>)
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">new_args</span> = <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:put</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">new_args</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- put_async-source -->
          
        </div>

        

        
      </div><!-- put_async-method -->

    
      <div id="method-i-redirect_uri_callback-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">redirect_uri_callback=</span><span
            class="method-args">(redirect_uri_callback)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets callback proc when <a href="HTTP.html">HTTP</a> redirect status is
returned for <a
href="HTTPClient.html#method-i-get_content">#get_content</a> and
post_content.  <a
href="HTTPClient.html#method-i-default_redirect_uri_callback">#default_redirect_uri_callback</a>
is used by default.</p>

<p>If you need strict implementation which does not allow relative <a
href="URI.html">URI</a> redirection, set <a
href="HTTPClient.html#method-i-strict_redirect_uri_callback">#strict_redirect_uri_callback</a>
instead.</p>

<pre>clnt.redirect_uri_callback = clnt.method(:strict_redirect_uri_callback)</pre>
          
          

          
          <div class="method-source-code" id="redirect_uri_callback-3D-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 598</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">redirect_uri_callback=</span>(<span class="ruby-identifier">redirect_uri_callback</span>)
  <span class="ruby-ivar">@redirect_uri_callback</span> = <span class="ruby-identifier">redirect_uri_callback</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- redirect_uri_callback-3D-source -->
          
        </div>

        

        
      </div><!-- redirect_uri_callback-3D-method -->

    
      <div id="method-i-request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">request</span><span
            class="method-args">(method, uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends a request to the specified URL.</p>
<dl class="rdoc-list note-list"><dt>method
<dd>
<p><a href="HTTP.html">HTTP</a> method to be sent.  method.to_s.upcase is
used.</p>
</dd><dt>uri
<dd>
<p>a <a href="String.html">String</a> or an <a href="URI.html">URI</a> object
which represents an URL of web resource.</p>
</dd><dt>query
<dd>
<p>a Hash or an Array of query part of URL. e.g. { a =&gt; b } =&gt;
&#39;<a href="http://host/part?a=b">host/part?a=b</a>&#39; Give an array to
pass multiple value like</p>
<dl class="rdoc-list label-list"><dt>[a, b], [a, c]
<dd>
<h1 id="method-i-request-label-%3E+%27http%3A%2F%2Fhost%2Fpart%3Fa%3Db%26a%3Dc%27">&gt; &#39;<a href="http://host/part?a=b&a=c">host/part?a=b&a=c</a>&#39;<span><a href="#method-i-request-label-%3E+%27http%3A%2F%2Fhost%2Fpart%3Fa%3Db%26a%3Dc%27">&para;</a> <a href="#documentation">&uarr;</a></span></h1>
</dd></dl>
</dd><dt>body
<dd>
<p>a Hash or an Array of body part. e.g.</p>

<pre class="ruby">{ <span class="ruby-string">&quot;a&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;b&quot;</span> }
=<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;a=b&#39;</span>
</pre>

<p>Give an array to pass multiple value like</p>

<pre class="ruby">[[<span class="ruby-string">&quot;a&quot;</span>, <span class="ruby-string">&quot;b&quot;</span>], [<span class="ruby-string">&quot;a&quot;</span>, <span class="ruby-string">&quot;c&quot;</span>]]
=<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;a=b&amp;a=c&#39;</span>.
</pre>

<p>When the given method is &#39;POST&#39; and the given body contains a file
as a value, it will be posted as a multipart/form-data. e.g.</p>

<pre class="ruby">{ <span class="ruby-string">&#39;upload&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span> }
</pre>

<p>You can also send custom multipart by passing an array of hashes. Each part
must have a :content attribute which can be a file, all other keys will
become headers.</p>

<pre class="ruby">[{ <span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>, :<span class="ruby-identifier">content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;some text&quot;</span> },
 { <span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;video/mp4&#39;</span>, :<span class="ruby-identifier">content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;video.mp4&#39;</span>) }]
=<span class="ruby-operator">&gt;</span> <span class="ruby-operator">&lt;</span><span class="ruby-constant">Two</span> <span class="ruby-identifier">parts</span> <span class="ruby-identifier">with</span> <span class="ruby-identifier">custom</span> <span class="ruby-constant">Content</span><span class="ruby-operator">-</span><span class="ruby-constant">Type</span> <span class="ruby-identifier">header</span><span class="ruby-operator">&gt;</span>
</pre>

<p>See <a href="HTTP/Message.html#method-c-file-3F">HTTP::Message.file?</a>
for actual condition of &#39;a file&#39;.</p>
</dd><dt>header
<dd>
<p>a Hash or an Array of extra headers.  e.g. { &#39;Accept&#39; =&gt;
&#39;text/html&#39; } or [[&#39;Accept&#39;, &#39;image/jpeg&#39;],
[&#39;Accept&#39;, &#39;image/png&#39;]].</p>
</dd><dt>&amp;block
<dd>
<p>Give a block to get chunked message-body of response like get(uri) {
|chunked_body|  }. Size of each chunk may not be the same.</p>
</dd></dl>

<p>You can also pass a <a href="String.html">String</a> as a body.  <a
href="HTTPClient.html">HTTPClient</a> just sends a <a
href="String.html">String</a> as a <a href="HTTP.html">HTTP</a> request
message body.</p>

<p>When you pass an IO as a body, <a href="HTTPClient.html">HTTPClient</a>
sends it as a <a href="HTTP.html">HTTP</a> request with chunked encoding
(Transfer-Encoding: chunked in <a href="HTTP.html">HTTP</a> header) if IO
does not respond to :size. Bear in mind that some server application does
not support chunked request.  At least cgi.rb does not support it.</p>
          
          

          
          <div class="method-source-code" id="request-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 802</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>, <span class="ruby-identifier">follow_redirect</span> = <span class="ruby-identifier">keyword_argument</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>, <span class="ruby-value">:follow_redirect</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value">:propfind</span>
    <span class="ruby-identifier">header</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">PROPFIND_DEFAULT_EXTHEADER</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">header</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">filtered_block</span> = <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">res</span>, <span class="ruby-identifier">str</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">str</span>)
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">filtered_block</span> = <span class="ruby-identifier">block</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">follow_redirect</span>
    <span class="ruby-identifier">follow_redirect</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">do_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">filtered_block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- request-source -->
          
        </div>

        

        
      </div><!-- request-method -->

    
      <div id="method-i-request_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">request_async</span><span
            class="method-args">(method, uri, query = nil, body = nil, header = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends a request in async style.  request method creates new Thread for <a
href="HTTP.html">HTTP</a> connection and returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance
immediately.</p>

<p>Arguments definition is the same as request.</p>
          
          

          
          <div class="method-source-code" id="request_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 894</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">request_async</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">body</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">header</span> = {})
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">do_request_async</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- request_async-source -->
          
        </div>

        

        
      </div><!-- request_async-method -->

    
      <div id="method-i-request_async2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">request_async2</span><span
            class="method-args">(method, uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>new method that has same signature as &#39;request&#39;</p>
          
          

          
          <div class="method-source-code" id="request_async2-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 900</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">request_async2</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span> = <span class="ruby-identifier">keyword_argument</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:body</span>, <span class="ruby-value">:header</span>)
  <span class="ruby-keyword">if</span> [<span class="ruby-value">:post</span>, <span class="ruby-value">:put</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-identifier">body</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value">:propfind</span>
    <span class="ruby-identifier">header</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">PROPFIND_DEFAULT_EXTHEADER</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">header</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">do_request_async</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- request_async2-source -->
          
        </div>

        

        
      </div><!-- request_async2-method -->

    
      <div id="method-i-reset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset</span><span
            class="method-args">(uri)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Resets internal session for the given URL.  Keep-alive connection for the
site (host-port pair) is disconnected if exists.</p>
          
          

          
          <div class="method-source-code" id="reset-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 916</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">reset</span>(<span class="ruby-identifier">uri</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset-source -->
          
        </div>

        

        
      </div><!-- reset-method -->

    
      <div id="method-i-reset_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_all</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Resets all of internal sessions.  Keep-alive connections are disconnected.</p>
          
          

          
          <div class="method-source-code" id="reset_all-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 922</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_all</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">reset_all</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_all-source -->
          
        </div>

        

        
      </div><!-- reset_all-method -->

    
      <div id="method-i-save_cookie_store" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_cookie_store</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Try to save Cookies to the file specified in set_cookie_store.  Unexpected
error will be raised if you don&#39;t call <a
href="HTTPClient.html#method-i-set_cookie_store">#set_cookie_store</a>
first.</p>
          
          

          
          <div class="method-source-code" id="save_cookie_store-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 579</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_cookie_store</span>
  <span class="ruby-ivar">@cookie_manager</span>.<span class="ruby-identifier">save_cookies</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- save_cookie_store-source -->
          
        </div>

        

        
      </div><!-- save_cookie_store-method -->

    
      <div id="method-i-set_auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_auth</span><span
            class="method-args">(domain, user, passwd)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets credential for Web server authentication.</p>
<dl class="rdoc-list note-list"><dt>domain
<dd>
<p>a <a href="String.html">String</a> or an <a href="URI.html">URI</a> to
specify where <a href="HTTPClient.html">HTTPClient</a> should use this</p>
</dd></dl>

<pre>credential.  If you set uri to nil, HTTPClient uses this credential
wherever a server requires it.</pre>
<dl class="rdoc-list note-list"><dt>user
<dd>
<p>username <a href="String.html">String</a>.</p>
</dd><dt>passwd
<dd>
<p>password <a href="String.html">String</a>.</p>
</dd></dl>

<p>You can set multiple credentials for each uri.</p>

<pre>clnt.set_auth(&#39;http://www.example.com/foo/&#39;, &#39;foo_user&#39;, &#39;passwd&#39;)
clnt.set_auth(&#39;http://www.example.com/bar/&#39;, &#39;bar_user&#39;, &#39;passwd&#39;)</pre>

<p>Calling this method resets all existing sessions.</p>
          
          

          
          <div class="method-source-code" id="set_auth-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 535</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_auth</span>(<span class="ruby-identifier">domain</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">passwd</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">domain</span>)
  <span class="ruby-ivar">@www_auth</span>.<span class="ruby-identifier">set_auth</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">passwd</span>)
  <span class="ruby-identifier">reset_all</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_auth-source -->
          
        </div>

        

        
      </div><!-- set_auth-method -->

    
      <div id="method-i-set_basic_auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_basic_auth</span><span
            class="method-args">(domain, user, passwd)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deprecated.  Use <a href="HTTPClient.html#method-i-set_auth">#set_auth</a>
instead.</p>
          
          

          
          <div class="method-source-code" id="set_basic_auth-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 542</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_basic_auth</span>(<span class="ruby-identifier">domain</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">passwd</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">domain</span>)
  <span class="ruby-ivar">@www_auth</span>.<span class="ruby-identifier">basic_auth</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">passwd</span>)
  <span class="ruby-identifier">reset_all</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_basic_auth-source -->
          
        </div>

        

        
      </div><!-- set_basic_auth-method -->

    
      <div id="method-i-set_cookie_store" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_cookie_store</span><span
            class="method-args">(filename)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets the filename where non-volatile Cookies be saved by calling
save_cookie_store. This method tries to load and managing Cookies from the
specified file.</p>

<p>Calling this method resets all existing sessions.</p>
          
          

          
          <div class="method-source-code" id="set_cookie_store-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 571</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_cookie_store</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-ivar">@cookie_manager</span>.<span class="ruby-identifier">cookies_file</span> = <span class="ruby-identifier">filename</span>
  <span class="ruby-ivar">@cookie_manager</span>.<span class="ruby-identifier">load_cookies</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">reset_all</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_cookie_store-source -->
          
        </div>

        

        
      </div><!-- set_cookie_store-method -->

    
      <div id="method-i-set_proxy_auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_proxy_auth</span><span
            class="method-args">(user, passwd)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets credential for Proxy authentication.</p>
<dl class="rdoc-list note-list"><dt>user
<dd>
<p>username <a href="String.html">String</a>.</p>
</dd><dt>passwd
<dd>
<p>password <a href="String.html">String</a>.</p>
</dd></dl>

<p>Calling this method resets all existing sessions.</p>
          
          

          
          <div class="method-source-code" id="set_proxy_auth-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 553</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_proxy_auth</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passwd</span>)
  <span class="ruby-ivar">@proxy_auth</span>.<span class="ruby-identifier">set_auth</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passwd</span>)
  <span class="ruby-identifier">reset_all</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_proxy_auth-source -->
          
        </div>

        

        
      </div><!-- set_proxy_auth-method -->

    
      <div id="method-i-strict_redirect_uri_callback" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">strict_redirect_uri_callback</span><span
            class="method-args">(uri, res)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A method for redirect uri callback.  How to use:</p>

<pre>clnt.redirect_uri_callback = clnt.method(:strict_redirect_uri_callback)</pre>

<p>This callback does not allow relative redirect such as</p>

<pre>Location: ../foo/</pre>

<p>in <a href="HTTP.html">HTTP</a> header. (raises <a
href="HTTPClient/BadResponseError.html">BadResponseError</a> instead)</p>
          
          

          
          <div class="method-source-code" id="strict_redirect_uri_callback-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 675</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">strict_redirect_uri_callback</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">res</span>)
  <span class="ruby-identifier">newuri</span> = <span class="ruby-identifier">urify</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">header</span>[<span class="ruby-string">&#39;location&#39;</span>][<span class="ruby-value">0</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">https?</span>(<span class="ruby-identifier">uri</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">https?</span>(<span class="ruby-identifier">newuri</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadResponseError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;redirecting to non-https resource&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">http?</span>(<span class="ruby-identifier">newuri</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">https?</span>(<span class="ruby-identifier">newuri</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadResponseError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;unexpected location: #{newuri}&quot;</span>, <span class="ruby-identifier">res</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;redirect to: #{newuri}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$DEBUG</span>
  <span class="ruby-identifier">newuri</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- strict_redirect_uri_callback-source -->
          
        </div>

        

        
      </div><!-- strict_redirect_uri_callback-method -->

    
      <div id="method-i-trace" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">trace</span><span
            class="method-args">(uri, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends TRACE request to the specified URL.  See request for arguments.</p>
          
          

          
          <div class="method-source-code" id="trace-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 760</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">trace</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-string">&#39;TRACE&#39;</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- trace-source -->
          
        </div>

        

        
      </div><!-- trace-method -->

    
      <div id="method-i-trace_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">trace_async</span><span
            class="method-args">(uri, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sends TRACE request in async style.  See <a
href="HTTPClient.html#method-i-request_async2">#request_async2</a> for
arguments. It immediately returns a <a
href="HTTPClient/Connection.html">HTTPClient::Connection</a> instance as a
result.</p>
          
          

          
          <div class="method-source-code" id="trace_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 886</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">trace_async</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">request_async2</span>(<span class="ruby-value">:trace</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">argument_to_hash</span>(<span class="ruby-identifier">args</span>, <span class="ruby-value">:query</span>, <span class="ruby-value">:header</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- trace_async-source -->
          
        </div>

        

        
      </div><!-- trace_async-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-create_boundary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_boundary</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_boundary-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_boundary</span>
  <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_boundary-source -->
          
        </div>

        

        
      </div><!-- create_boundary-method -->

    
      <div id="method-i-create_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_request</span><span
            class="method-args">(method, uri, query, body, header)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_request-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1094</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>)
  <span class="ruby-identifier">method</span> = <span class="ruby-identifier">method</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">header</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
    <span class="ruby-identifier">header</span> = <span class="ruby-ivar">@default_header</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">header</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">header</span> = <span class="ruby-ivar">@default_header</span>.<span class="ruby-identifier">to_a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">header</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">boundary</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">header</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">key</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;content-type&#39;</span>
    }
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_type</span>
      <span class="ruby-keyword">if</span> <span class="ruby-regexp">/\Amultipart/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">content_type</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_type</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/boundary=(.+)\z/</span>
          <span class="ruby-identifier">boundary</span> = <span class="ruby-node">$1</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">boundary</span> = <span class="ruby-identifier">create_boundary</span>
          <span class="ruby-identifier">content_type</span> = <span class="ruby-node">&quot;#{content_type}; boundary=#{boundary}&quot;</span>
          <span class="ruby-identifier">header</span> = <span class="ruby-identifier">override_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-string">&#39;Content-Type&#39;</span>, <span class="ruby-identifier">content_type</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">file_in_form_data?</span>(<span class="ruby-identifier">body</span>)
        <span class="ruby-identifier">boundary</span> = <span class="ruby-identifier">create_boundary</span>
        <span class="ruby-identifier">content_type</span> = <span class="ruby-node">&quot;multipart/form-data; boundary=#{boundary}&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">content_type</span> = <span class="ruby-string">&#39;application/x-www-form-urlencoded&#39;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">header</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-string">&#39;Content-Type&#39;</span>, <span class="ruby-identifier">content_type</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">req</span> = <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">new_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">boundary</span>)
  <span class="ruby-identifier">header</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cookie_manager</span>
    <span class="ruby-identifier">cookie_value</span> = <span class="ruby-ivar">@cookie_manager</span>.<span class="ruby-identifier">cookie_value</span>(<span class="ruby-identifier">uri</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookie_value</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">add</span>(<span class="ruby-string">&#39;Cookie&#39;</span>, <span class="ruby-identifier">cookie_value</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">req</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_request-source -->
          
        </div>

        

        
      </div><!-- create_request-method -->

    
      <div id="method-i-do_get_block" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">do_get_block</span><span
            class="method-args">(req, proxy, conn, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>!! CAUTION !!</p>

<pre>Method &#39;do_get*&#39; runs under MT conditon. Be careful to change.</pre>
          
          

          
          <div class="method-source-code" id="do_get_block-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">do_get_block</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">proxy</span>, <span class="ruby-identifier">conn</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@request_filter</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">filter_request</span>(<span class="ruby-identifier">req</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span> = <span class="ruby-ivar">@test_loopback_response</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-identifier">dump_dummy_request_response</span>(<span class="ruby-identifier">req</span>.<span class="ruby-identifier">http_body</span>.<span class="ruby-identifier">dump</span>, <span class="ruby-identifier">str</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug_dev</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">new_response</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">res</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">content</span> = <span class="ruby-identifier">block</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">new_response</span>(<span class="ruby-identifier">content</span>, <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>)
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;= Request\n\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug_dev</span>
  <span class="ruby-identifier">sess</span> = <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">query</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">proxy</span>)
  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">peer_cert</span> = <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">ssl_peer_cert</span>
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n\n= Response\n\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug_dev</span>
  <span class="ruby-identifier">do_get_header</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">sess</span>)
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">res</span>)
  <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">get_body</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">set_encoding</span>(<span class="ruby-identifier">part</span>, <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body_encoding</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
      <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">res</span>, <span class="ruby-identifier">part</span>.<span class="ruby-identifier">dup</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">content</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># there could be a race condition but it&#39;s OK to cache unreusable</span>
  <span class="ruby-comment"># connection because we do retry for that case.</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">keep</span>(<span class="ruby-identifier">sess</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">closed?</span>
  <span class="ruby-identifier">commands</span> = <span class="ruby-ivar">@request_filter</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">filter_response</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
  }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">commands</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">command</span><span class="ruby-operator">|</span> <span class="ruby-identifier">command</span> <span class="ruby-operator">==</span> <span class="ruby-value">:retry</span> }
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">RetryableResponse</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">res</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- do_get_block-source -->
          
        </div>

        

        
      </div><!-- do_get_block-method -->

    
      <div id="method-i-do_get_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">do_get_header</span><span
            class="method-args">(req, res, sess)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="do_get_header-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">do_get_header</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">sess</span>)
  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">http_version</span>, <span class="ruby-identifier">res</span>.<span class="ruby-identifier">status</span>, <span class="ruby-identifier">res</span>.<span class="ruby-identifier">reason</span>, <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">get_header</span>
  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">set_headers</span>(<span class="ruby-identifier">headers</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cookie_manager</span>
    <span class="ruby-identifier">res</span>.<span class="ruby-identifier">header</span>[<span class="ruby-string">&#39;set-cookie&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cookie</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@cookie_manager</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">cookie</span>, <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">request_uri</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- do_get_header-source -->
          
        </div>

        

        
      </div><!-- do_get_header-method -->

    
      <div id="method-i-do_get_stream" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">do_get_stream</span><span
            class="method-args">(req, proxy, conn)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="do_get_stream-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">do_get_stream</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">proxy</span>, <span class="ruby-identifier">conn</span>)
  <span class="ruby-ivar">@request_filter</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">filter_request</span>(<span class="ruby-identifier">req</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span> = <span class="ruby-ivar">@test_loopback_response</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-identifier">dump_dummy_request_response</span>(<span class="ruby-identifier">req</span>.<span class="ruby-identifier">http_body</span>.<span class="ruby-identifier">dump</span>, <span class="ruby-identifier">str</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug_dev</span>
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">new_response</span>(<span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">str</span>), <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>))
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">piper</span>, <span class="ruby-identifier">pipew</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">new_response</span>(<span class="ruby-identifier">piper</span>, <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>)
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;= Request\n\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug_dev</span>
  <span class="ruby-identifier">sess</span> = <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">query</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">proxy</span>)
  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">peer_cert</span> = <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">ssl_peer_cert</span>
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n\n= Response\n\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug_dev</span>
  <span class="ruby-identifier">do_get_header</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">sess</span>)
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">res</span>)
  <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">get_body</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">set_encoding</span>(<span class="ruby-identifier">part</span>, <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body_encoding</span>)
    <span class="ruby-identifier">pipew</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">part</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pipew</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">keep</span>(<span class="ruby-identifier">sess</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">closed?</span>
  <span class="ruby-identifier">_</span> = <span class="ruby-ivar">@request_filter</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">filter_response</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
  }
  <span class="ruby-comment"># ignore commands (not retryable in async mode)</span>
  <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- do_get_stream-source -->
          
        </div>

        

        
      </div><!-- do_get_stream-method -->

    
      <div id="method-i-do_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">do_request</span><span
            class="method-args">(method, uri, query, body, header, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="do_request-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 953</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">do_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">res</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">body</span>)
    <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">pos</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">retry_count</span> = <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">protocol_retry_count</span>
  <span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">no_proxy?</span>(<span class="ruby-identifier">uri</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@proxy</span>
  <span class="ruby-identifier">previous_request</span> = <span class="ruby-identifier">previous_response</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">retry_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">body</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">pos</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pos</span>
    <span class="ruby-identifier">req</span> = <span class="ruby-identifier">create_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">previous_request</span>
      <span class="ruby-comment"># to remember IO positions to read</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">http_body</span>.<span class="ruby-identifier">positions</span> = <span class="ruby-identifier">previous_request</span>.<span class="ruby-identifier">http_body</span>.<span class="ruby-identifier">positions</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">protect_keep_alive_disconnected</span> <span class="ruby-keyword">do</span>
        <span class="ruby-comment"># TODO: remove Connection.new</span>
        <span class="ruby-comment"># We want to delete Connection usage in do_get_block but Newrelic gem depends on it.</span>
        <span class="ruby-comment"># https://github.com/newrelic/rpm/blob/master/lib/new_relic/agent/instrumentation/httpclient.rb#L34-L36</span>
        <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Connection</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">res</span> = <span class="ruby-identifier">do_get_block</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">proxy</span>, <span class="ruby-identifier">conn</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-comment"># Webmock&#39;s do_get_block returns ConditionVariable</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">res</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:previous</span>)
          <span class="ruby-identifier">res</span> = <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">pop</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">res</span>.<span class="ruby-identifier">previous</span> = <span class="ruby-identifier">previous_response</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">RetryableResponse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">previous_request</span> = <span class="ruby-identifier">req</span>
      <span class="ruby-identifier">previous_response</span> = <span class="ruby-identifier">res</span> = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">res</span>
      <span class="ruby-identifier">retry_count</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- do_request-source -->
          
        </div>

        

        
      </div><!-- do_request-method -->

    
      <div id="method-i-do_request_async" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">do_request_async</span><span
            class="method-args">(method, uri, query, body, header)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="do_request_async-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 991</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">do_request_async</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>)
  <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Connection</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">t</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">conn</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">tconn</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">if</span> <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">body</span>)
        <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">pos</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">retry_count</span> = <span class="ruby-ivar">@session_manager</span>.<span class="ruby-identifier">protocol_retry_count</span>
      <span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">no_proxy?</span>(<span class="ruby-identifier">uri</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@proxy</span>
      <span class="ruby-keyword">while</span> <span class="ruby-identifier">retry_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">body</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">pos</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pos</span>
        <span class="ruby-identifier">req</span> = <span class="ruby-identifier">create_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>)
        <span class="ruby-keyword">begin</span>
          <span class="ruby-identifier">protect_keep_alive_disconnected</span> <span class="ruby-keyword">do</span>
            <span class="ruby-identifier">do_get_stream</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">proxy</span>, <span class="ruby-identifier">tconn</span>)
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">break</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">RetryableResponse</span>
          <span class="ruby-identifier">retry_count</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">e</span>
    <span class="ruby-keyword">end</span>
  }
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">async_thread</span> = <span class="ruby-identifier">t</span>
  <span class="ruby-identifier">conn</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- do_request_async-source -->
          
        </div>

        

        
      </div><!-- do_request_async-method -->

    
      <div id="method-i-dump_dummy_request_response" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dump_dummy_request_response</span><span
            class="method-args">(req, res)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="dump_dummy_request_response-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dump_dummy_request_response</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;= Dummy Request\n\n&quot;</span>
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">req</span>
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n\n= Dummy Response\n\n&quot;</span>
  <span class="ruby-ivar">@debug_dev</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dump_dummy_request_response-source -->
          
        </div>

        

        
      </div><!-- dump_dummy_request_response-method -->

    
      <div id="method-i-file_in_form_data-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_in_form_data?</span><span
            class="method-args">(body)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="file_in_form_data-3F-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_in_form_data?</span>(<span class="ruby-identifier">body</span>)
  <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">multiparam_query?</span>(<span class="ruby-identifier">body</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-identifier">body</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">v</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- file_in_form_data-3F-source -->
          
        </div>

        

        
      </div><!-- file_in_form_data-3F-method -->

    
      <div id="method-i-follow_redirect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">follow_redirect</span><span
            class="method-args">(method, uri, query, body, header, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="follow_redirect-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1038</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">follow_redirect</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">filtered_block</span> = <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span>, <span class="ruby-identifier">str</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">str</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">ok?</span>
    }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">body</span>)
    <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">pos</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">retry_number</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">previous</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">request_query</span> = <span class="ruby-identifier">query</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">retry_number</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@follow_redirect_count</span>
    <span class="ruby-identifier">body</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">pos</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pos</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">do_request</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">request_query</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">header</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">filtered_block</span>)
    <span class="ruby-identifier">res</span>.<span class="ruby-identifier">previous</span> = <span class="ruby-identifier">previous</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">redirect?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">header</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadResponseError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Missing Location header for redirect&quot;</span>, <span class="ruby-identifier">res</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">method</span> = <span class="ruby-value">:get</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">see_other?</span> <span class="ruby-comment"># See RFC2616 10.3.4</span>
      <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">urify</span>(<span class="ruby-ivar">@redirect_uri_callback</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">res</span>))
      <span class="ruby-comment"># To avoid duped query parameter. &#39;location&#39; must include query part.</span>
      <span class="ruby-identifier">request_query</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">previous</span> = <span class="ruby-identifier">res</span>
      <span class="ruby-identifier">retry_number</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadResponseError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;retry count exceeded&quot;</span>, <span class="ruby-identifier">res</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- follow_redirect-source -->
          
        </div>

        

        
      </div><!-- follow_redirect-method -->

    
      <div id="method-i-getenv" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getenv</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="getenv-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1034</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getenv</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">upcase</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- getenv-source -->
          
        </div>

        

        
      </div><!-- getenv-method -->

    
      <div id="method-i-hashy_argument_has_keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hashy_argument_has_keys</span><span
            class="method-args">(args, *key)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="hashy_argument_has_keys-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 946</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hashy_argument_has_keys</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">key</span>)
  <span class="ruby-comment"># if the given arg is a single Hash and...</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword">and</span>
    <span class="ruby-comment"># it has any one of the key</span>
    <span class="ruby-identifier">key</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">e</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- hashy_argument_has_keys-source -->
          
        </div>

        

        
      </div><!-- hashy_argument_has_keys-method -->

    
      <div id="method-i-load_environment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_environment</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="load_environment-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1020</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_environment</span>
  <span class="ruby-comment"># http_proxy</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">getenv</span>(<span class="ruby-string">&#39;REQUEST_METHOD&#39;</span>)
    <span class="ruby-comment"># HTTP_PROXY conflicts with the environment variable usage in CGI where</span>
    <span class="ruby-comment"># HTTP_* is used for HTTP header information.  Unlike open-uri, we</span>
    <span class="ruby-comment"># simply ignore http_proxy in CGI env and use cgi_http_proxy instead.</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">getenv</span>(<span class="ruby-string">&#39;cgi_http_proxy&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">getenv</span>(<span class="ruby-string">&#39;http_proxy&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># no_proxy</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">no_proxy</span> = <span class="ruby-identifier">getenv</span>(<span class="ruby-string">&#39;no_proxy&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_environment-source -->
          
        </div>

        

        
      </div><!-- load_environment-method -->

    
      <div id="method-i-no_proxy-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">no_proxy?</span><span
            class="method-args">(uri)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="no_proxy-3F-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">no_proxy?</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@proxy</span> <span class="ruby-keyword">or</span> <span class="ruby-constant">NO_PROXY_HOSTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@no_proxy_regexps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">regexp</span>, <span class="ruby-identifier">port</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">port</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">port</span>.<span class="ruby-identifier">to_i</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">regexp</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- no_proxy-3F-source -->
          
        </div>

        

        
      </div><!-- no_proxy-3F-method -->

    
      <div id="method-i-override_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">override_header</span><span
            class="method-args">(header, key, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="override_header-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">override_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">result</span> = []
  <span class="ruby-identifier">header</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">downcase</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- override_header-source -->
          
        </div>

        

        
      </div><!-- override_header-method -->

    
      <div id="method-i-protect_keep_alive_disconnected" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">protect_keep_alive_disconnected</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="protect_keep_alive_disconnected-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1080</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">protect_keep_alive_disconnected</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">KeepAliveDisconnected</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Force to create new connection</span>
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:HTTPClient_AcquireNewConnection</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">yield</span>
    <span class="ruby-keyword">ensure</span>
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:HTTPClient_AcquireNewConnection</span>] = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- protect_keep_alive_disconnected-source -->
          
        </div>

        

        
      </div><!-- protect_keep_alive_disconnected-method -->

    
      <div id="method-i-set_encoding" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_encoding</span><span
            class="method-args">(str, encoding)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_encoding-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">encoding</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_encoding-source -->
          
        </div>

        

        
      </div><!-- set_encoding-method -->

    
      <div id="method-i-success_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">success_content</span><span
            class="method-args">(res)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="success_content-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1072</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">success_content</span>(<span class="ruby-identifier">res</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">ok?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">content</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadResponseError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;unexpected response: #{res.header.inspect}&quot;</span>, <span class="ruby-identifier">res</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- success_content-source -->
          
        </div>

        

        
      </div><!-- success_content-method -->

    
      <div id="method-i-to_resource_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_resource_url</span><span
            class="method-args">(uri)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="to_resource_url-source">
            <pre><span class="ruby-comment"># File lib/httpclient.rb, line 1267</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_resource_url</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">u</span> = <span class="ruby-identifier">urify</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@base_url</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">urify</span>(<span class="ruby-ivar">@base_url</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">u</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- to_resource_url-source -->
          
        </div>

        

        
      </div><!-- to_resource_url-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

